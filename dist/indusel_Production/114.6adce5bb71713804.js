"use strict";(self.webpackChunkfree_version=self.webpackChunkfree_version||[]).push([[114],{114:(L,u,n)=>{n.r(u),n.d(u,{PrintingParameters:()=>T});var l=n(8728),a=n(4341),f=n(1413),m=n(7673),v=n(152),b=n(3294),P=n(5558),p=n(9437),E=n(980),h=n(6977),C=n(8312),N=n(9330),F=n(8810),g=n(2525);let R=(()=>{class r{constructor(){this.http=(0,l.WQX)(N.Qq),this.BASE_URL=g.c.backendUrl,this.BASE_API=g.c.api,this.LABEL_PARAMETERS_ENDPOINT=`${this.BASE_URL}${this.BASE_API}/printing/labelParameters`}handleError(t){let o="Ocurri\xf3 un error desconocido en el servicio.";return t.error&&t.error.msg?o=t.error.msg:t.message&&(o=t.message),(0,F.$)(()=>new Error(`Fall\xf3 la consulta al backend: ${o}`))}postLabelParameters(t){return this.http.post(this.LABEL_PARAMETERS_ENDPOINT,t).pipe((0,p.W)(this.handleError.bind(this)))}static{this.\u0275fac=function(o){return new(o||r)}}static{this.\u0275prov=l.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var y=n(2389),e=n(3664),c=n(2200);const x=r=>({loading:r}),k=(r,s)=>({"alert-success":r,"alert-danger":s});function A(r,s){if(1&r){const t=e.RV6();e.j41(0,"div",33),e.bIt("click",function(){const i=l.eBV(t).$implicit,d=e.XpG(2);return l.Njj(d.selectReference(i))}),e.j41(1,"div")(2,"strong"),e.EFF(3),e.k0s()(),e.j41(4,"div",34),e.EFF(5),e.k0s()()}if(2&r){const t=s.$implicit;e.R7$(3),e.JRh(t.reference),e.R7$(2),e.JRh(t.productName)}}function j(r,s){if(1&r&&(e.j41(0,"div",31),e.DNE(1,A,6,2,"div",32),e.k0s()),2&r){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.predictiveList)}}function I(r,s){1&r&&(e.j41(0,"div",35),e.nrm(1,"div",36),e.k0s())}function O(r,s){1&r&&(e.j41(0,"div",37),e.EFF(1," La referencia de producci\xf3n es obligatoria. "),e.k0s())}function $(r,s){1&r&&(e.j41(0,"div",37),e.EFF(1," El consecutivo (label.code) es obligatorio. "),e.k0s())}function M(r,s){if(1&r&&(e.j41(0,"div",38)(1,"div",39),e.EFF(2),e.k0s()()),2&r){const t=e.XpG();e.R7$(),e.Y8G("ngClass",e.l_i(2,k,"success"===t.alert.type,"danger"===t.alert.type)),e.R7$(),e.SpI(" ",t.alert.message," ")}}let T=(()=>{class r{constructor(){this.dashboardService=(0,l.WQX)(C.T),this.printingLabelsService=(0,l.WQX)(R),this.fb=(0,l.WQX)(a.ok),this.predictiveList=[],this.showDropdown=!1,this.loading=!1,this.submitting=!1,this.selectedProduct=null,this.alert={visible:!1,type:"success",message:""},this.search$=new f.B,this.destroy$=new f.B}ngOnInit(){this.form=this.fb.group({productReference:["",a.k0.required],quantity:[1],printer:[""],includeLogo:[!1],includeBarcode:[!0],productName:[""],EAN:[""],productCode:[""],reference:[""],codRef:[""],labelCode:[null,a.k0.required],labelNote:[""]}),this.search$.pipe((0,v.B)(300),(0,b.F)(),(0,P.n)(t=>{const o=(t||"").trim();return 0===o.length?(this.predictiveList=[],this.loading=!1,(0,m.of)(null)):(this.loading=!0,this.dashboardService.searchReferences(o).pipe((0,p.W)(i=>(console.error("Error al buscar referencias:",i),(0,m.of)({ok:!1,msg:[]}))),(0,E.j)(()=>this.loading=!1)))}),(0,h.Q)(this.destroy$)).subscribe(t=>{t&&(this.predictiveList=t?.msg||[],this.showDropdown=this.predictiveList.length>0)})}onReferenceInput(t){this.search$.next(t.target.value),this.selectedProduct=null,this.clearProductFields()}onFocus(){this.predictiveList.length>0&&(this.showDropdown=!0)}onBlur(){setTimeout(()=>{this.showDropdown=!1},180)}selectReference(t){this.selectedProduct={productName:t.productName,EAN:t.EAN,productCode:t.productCode,reference:t.reference,codRef:t.productCode},this.form.patchValue({productReference:t.reference,productName:t.productName,EAN:t.EAN,productCode:t.productCode,reference:t.reference,codRef:t.productCode}),this.predictiveList=[],this.showDropdown=!1}isFieldInvalid(t){const o=this.form.get(t);return!(!o||!o.invalid||!o.dirty&&!o.touched)}onCancel(){this.form.reset({productReference:"",quantity:1,printer:"",includeLogo:!1,includeBarcode:!0,labelCode:null,labelNote:"",productName:"",EAN:"",productCode:"",reference:"",codRef:""}),this.selectedProduct=null,this.alert.visible=!1}clearProductFields(){this.form.patchValue({productName:"",EAN:"",productCode:"",reference:"",codRef:""})}get labelPreview(){const t={productName:this.form.value.productName||this.selectedProduct?.productName||"",EAN:this.form.value.EAN||this.selectedProduct?.EAN||"",reference:this.form.value.reference||this.selectedProduct?.reference||this.form.value.productReference,codRef:this.form.value.codRef||this.selectedProduct?.codRef||this.form.value.productCode||"",label:{code:null!=this.form.value.labelCode?Number(this.form.value.labelCode):null,note:this.form.value.labelNote||""}};return JSON.stringify(t,null,2)}onSubmit(){if(this.form.invalid)return void this.form.markAllAsTouched();const t={productName:this.form.value.productName||this.selectedProduct?.productName||"",EAN:this.form.value.EAN||this.selectedProduct?.EAN||"",reference:this.form.value.reference||this.selectedProduct?.reference||this.form.value.productReference,codRef:this.form.value.codRef||this.selectedProduct?.codRef||this.form.value.productCode||"",label:{code:Number(this.form.value.labelCode),note:(this.form.value.labelNote||"").toString()}};this.submitting=!0,this.alert.visible=!1,this.printingLabelsService.postLabelParameters(t).pipe((0,h.Q)(this.destroy$)).subscribe({next:o=>{this.submitting=!1,this.alert.visible=!0,o&&o.ok?(this.alert.type="success",this.alert.message=o.msg||"Referencia registrada exitosamente.",this.form.patchValue({labelCode:null,labelNote:""})):(this.alert.type="danger",this.alert.message=o?.msg||"Error en el registro de la referencia")},error:o=>{this.submitting=!1,this.alert.visible=!0,this.alert.type="danger",this.alert.message=o?.message||"Error al enviar al backend"}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(o){return new(o||r)}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-printing-parameters"]],decls:63,vars:10,consts:[[1,"inventory-container",3,"ngClass"],[1,"header"],["novalidate","",1,"main-content",3,"ngSubmit","formGroup"],[1,"left-panel",2,"display","flex","gap","2rem","flex-wrap","wrap"],[2,"flex","1 1 45%","min-width","300px"],[1,"form-group"],["for","productReference"],[1,"position-relative"],["id","productReference","type","text","formControlName","productReference","placeholder","Escriba c\xf3digo o nombre de referencia","autocomplete","off",1,"form-control",3,"input","focus","blur"],["class","autocomplete-results shadow-lg",4,"ngIf"],["class","spinner","aria-hidden","true",4,"ngIf"],["class","invalid-feedback",4,"ngIf"],["for","productName"],["id","productName","type","text","formControlName","productName","readonly","",1,"form-control"],["for","EAN"],["id","EAN","type","text","formControlName","EAN","readonly","",1,"form-control"],["for","productCode"],["id","productCode","type","text","formControlName","productCode","readonly","",1,"form-control"],["for","reference"],["id","reference","type","text","formControlName","reference","readonly","",1,"form-control"],["for","codRef"],["id","codRef","type","text","formControlName","codRef","readonly","",1,"form-control"],["for","labelCode"],[1,"text-danger"],["id","labelCode","type","number","formControlName","labelCode","placeholder","Ingrese consecutivo/serial para la etiqueta","required","",1,"form-control"],["for","labelNote"],["id","labelNote","rows","2","formControlName","labelNote","placeholder","Agregar una nota (opcional)",1,"form-control"],[1,"button-group",2,"margin-top","1rem"],["type","button",1,"btn-secondary",3,"click"],["type","submit",1,"btn-primary",3,"disabled"],["class","mt-3",4,"ngIf"],[1,"autocomplete-results","shadow-lg"],["class","autocomplete-item",3,"click",4,"ngFor","ngForOf"],[1,"autocomplete-item",3,"click"],[1,"text-muted","small"],["aria-hidden","true",1,"spinner"],["role","status",1,"spinner-border","spinner-border-sm","text-primary"],[1,"invalid-feedback"],[1,"mt-3"],["role","alert",1,"alert",3,"ngClass"]],template:function(o,i){1&o&&(e.j41(0,"div",0)(1,"header",1)(2,"h1"),e.EFF(3,"Par\xe1metros de Etiquetas"),e.k0s()(),e.j41(4,"form",2),e.bIt("ngSubmit",function(){return i.onSubmit()}),e.j41(5,"section",3)(6,"div",4)(7,"h2"),e.EFF(8,"Configuraci\xf3n de Par\xe1metros"),e.k0s(),e.j41(9,"div",5)(10,"label",6),e.EFF(11,"Referencia en Producci\xf3n (*)"),e.k0s(),e.j41(12,"div",7)(13,"input",8),e.bIt("input",function(w){return i.onReferenceInput(w)})("focus",function(){return i.onFocus()})("blur",function(){return i.onBlur()}),e.k0s(),e.DNE(14,j,2,1,"div",9)(15,I,2,0,"div",10),e.k0s(),e.DNE(16,O,2,0,"div",11),e.k0s(),e.nrm(17,"hr"),e.j41(18,"h3"),e.EFF(19,"Informaci\xf3n de la Referencia"),e.k0s(),e.j41(20,"div",5)(21,"label",12),e.EFF(22,"Nombre Producto"),e.k0s(),e.nrm(23,"input",13),e.k0s(),e.j41(24,"div",5)(25,"label",14),e.EFF(26,"EAN"),e.k0s(),e.nrm(27,"input",15),e.k0s(),e.j41(28,"div",5)(29,"label",16),e.EFF(30,"C\xf3digo Producto"),e.k0s(),e.nrm(31,"input",17),e.k0s()(),e.j41(32,"div",4)(33,"h3"),e.EFF(34,"\xa0"),e.k0s(),e.j41(35,"div",5)(36,"label",18),e.EFF(37,"Referencia"),e.k0s(),e.nrm(38,"input",19),e.k0s(),e.j41(39,"div",5)(40,"label",20),e.EFF(41,"codRef"),e.k0s(),e.nrm(42,"input",21),e.k0s(),e.nrm(43,"hr"),e.j41(44,"h3"),e.EFF(45,"Etiqueta"),e.k0s(),e.j41(46,"div",5)(47,"label",22),e.EFF(48,"Consecutivo (label.code) "),e.j41(49,"span",23),e.EFF(50,"*"),e.k0s()(),e.nrm(51,"input",24),e.DNE(52,$,2,0,"div",11),e.k0s(),e.j41(53,"div",5)(54,"label",25),e.EFF(55,"Notas (opcional)"),e.k0s(),e.nrm(56,"textarea",26),e.k0s(),e.j41(57,"div",27)(58,"button",28),e.bIt("click",function(){return i.onCancel()}),e.EFF(59,"Cancelar"),e.k0s(),e.j41(60,"button",29),e.EFF(61,"Guardar Referencia"),e.k0s()(),e.DNE(62,M,3,5,"div",30),e.k0s()()()()),2&o&&(e.Y8G("ngClass",e.eq3(8,x,i.loading)),e.R7$(4),e.Y8G("formGroup",i.form),e.R7$(10),e.Y8G("ngIf",i.predictiveList.length>0&&i.showDropdown),e.R7$(),e.Y8G("ngIf",i.loading),e.R7$(),e.Y8G("ngIf",i.isFieldInvalid("productReference")),e.R7$(36),e.Y8G("ngIf",i.isFieldInvalid("labelCode")),e.R7$(8),e.Y8G("disabled",i.form.invalid||i.submitting),e.R7$(2),e.Y8G("ngIf",i.alert.visible))},dependencies:[y.G,c.YU,c.Sq,c.bT,a.qT,a.me,a.Q0,a.BC,a.cb,a.YS,a.j4,a.JD,a.X1],styles:['@import"https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap";.inventory-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh;font-family:Inter,sans-serif;background:#f5f7fa}.header[_ngcontent-%COMP%]{background:linear-gradient(90deg,#87d1e6,#036);color:#fff;padding:1.2rem 1.5rem;text-align:center;font-weight:600;font-size:1.6rem;box-shadow:0 4px 8px #0000001f;border-radius:10px}.main-content[_ngcontent-%COMP%]{display:flex;gap:1.5rem;max-width:1200px;margin:1.5rem auto;width:100%;padding:0}.left-panel[_ngcontent-%COMP%]{flex:4;background:#fff;border-radius:12px;padding:1.5rem;box-shadow:0 8px 18px #0000000f}.right-panel[_ngcontent-%COMP%]{flex:6;background:#fff;border-radius:12px;padding:1.5rem;box-shadow:0 8px 18px #0000000f}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}label[_ngcontent-%COMP%]{font-weight:600;color:#3b5998}.form-control[_ngcontent-%COMP%]{border-radius:8px;padding:.6rem .9rem;border:1px solid #d6dde8}.position-relative[_ngcontent-%COMP%]{position:relative}.autocomplete-results[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 6px);left:0;right:0;z-index:999;background:#fff;border-radius:8px;border:1px solid #e6eefc;overflow-y:auto;max-height:300px}.autocomplete-item[_ngcontent-%COMP%]{padding:10px 14px;cursor:pointer;border-bottom:1px solid #f1f5fb}.autocomplete-item[_ngcontent-%COMP%]:hover{background:#f0f4ff}.spinner[_ngcontent-%COMP%]{position:absolute;right:12px;top:50%;transform:translateY(-50%)}.button-group[_ngcontent-%COMP%]{display:flex;gap:12px;margin-top:1rem}.btn-primary[_ngcontent-%COMP%]{background:#4b6cb7;border:none;color:#fff;padding:.6rem 1rem;border-radius:8px;font-weight:600}.btn-secondary[_ngcontent-%COMP%]{background:#a0aec0;border:none;color:#fff;padding:.6rem 1rem;border-radius:8px}.product-details[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#4b6cb7;margin-top:0}.placeholder[_ngcontent-%COMP%]{color:#a0aec0;font-style:italic;text-align:center;padding:2rem 0}@media (max-width: 900px){.main-content[_ngcontent-%COMP%]{flex-direction:column;padding:0 1rem}}']})}}return r})()}}]);