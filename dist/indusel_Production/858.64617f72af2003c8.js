"use strict";(self.webpackChunkfree_version=self.webpackChunkfree_version||[]).push([[858],{1858:(S,m,d)=>{d.r(m),d.d(m,{WineryNews:()=>j});var u=d(2200),l=d(8728),s=d(9417),p=d(152),f=d(5964),g=d(8141),v=d(5558),_=d(8312),h=d(4061),e=d(3664);const c=o=>({"is-invalid":o});function b(o,n){if(1&o){const t=e.RV6();e.j41(0,"div",34),e.nrm(1,"i",35),e.j41(2,"div",36)(3,"h5",37),e.EFF(4,"\xa1Novedad de Bodega Registrada!"),e.k0s(),e.j41(5,"p",38),e.EFF(6),e.k0s()(),e.j41(7,"button",39),e.bIt("click",function(){l.eBV(t);const i=e.XpG(2);return l.Njj(i.submitSuccess=!1)}),e.k0s()()}if(2&o){const t=e.XpG(2);e.R7$(6),e.JRh(t.successMessage)}}function w(o,n){if(1&o){const t=e.RV6();e.j41(0,"div",40),e.nrm(1,"i",41),e.j41(2,"div",36)(3,"h5",37),e.EFF(4,"Error al Registrar Novedad"),e.k0s(),e.j41(5,"p",38),e.EFF(6),e.k0s()(),e.j41(7,"button",39),e.bIt("click",function(){l.eBV(t);const i=e.XpG(2);return l.Njj(i.submitError="")}),e.k0s()()}if(2&o){const t=e.XpG(2);e.R7$(6),e.JRh(t.submitError)}}function F(o,n){1&o&&(e.j41(0,"div",42)(1,"div",43)(2,"span",44),e.EFF(3,"Cargando..."),e.k0s()(),e.j41(4,"div",36)(5,"h5",37),e.EFF(6,"Procesando..."),e.k0s(),e.j41(7,"p",38),e.EFF(8,"Registrando la novedad de bodega, por favor espere."),e.k0s()()())}function N(o,n){if(1&o&&(e.j41(0,"div",30),e.DNE(1,b,8,1,"div",31)(2,w,8,1,"div",32)(3,F,9,0,"div",33),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.submitSuccess),e.R7$(),e.Y8G("ngIf",t.submitError),e.R7$(),e.Y8G("ngIf",t.isSubmitting)}}function E(o,n){1&o&&(e.j41(0,"div",45),e.EFF(1,"La fecha es obligatoria."),e.k0s())}function y(o,n){if(1&o&&(e.j41(0,"option",46),e.EFF(1),e.k0s()),2&o){const t=n.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function R(o,n){1&o&&(e.j41(0,"div",45),e.EFF(1,"Debe seleccionar un tipo de novedad."),e.k0s())}function k(o,n){if(1&o){const t=e.RV6();e.j41(0,"div",49),e.bIt("click",function(){const i=l.eBV(t).$implicit,a=e.XpG(2);return l.Njj(a.selectReference(i))}),e.EFF(1),e.k0s()}if(2&o){const t=n.$implicit;e.R7$(),e.SpI(" ",t," ")}}function D(o,n){if(1&o&&(e.j41(0,"div",47),e.DNE(1,k,2,1,"div",48),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.predictiveList)}}function P(o,n){1&o&&(e.j41(0,"div",45),e.EFF(1,"La referencia de producci\xf3n es obligatoria."),e.k0s())}function C(o,n){1&o&&(e.j41(0,"div",45),e.EFF(1,"La cantidad es obligatoria y debe ser mayor a 0."),e.k0s())}function I(o,n){1&o&&(e.j41(0,"div",45),e.EFF(1,"El detalle es obligatorio y requiere una descripci\xf3n m\xednima."),e.k0s())}function M(o,n){1&o&&(e.j41(0,"span"),e.nrm(1,"i",50),e.EFF(2," Registrar Novedad "),e.k0s())}function T(o,n){1&o&&(e.j41(0,"span"),e.nrm(1,"span",51),e.EFF(2," Registrando... "),e.k0s())}let j=(()=>{class o{constructor(){this.dashboardService=(0,l.WQX)(_.T),this.fb=(0,l.WQX)(s.ok),this.newsServices=(0,l.WQX)(h.s),this.tiposNovedad=["Calidad en Producto","Producto Incompleto","Producto Sin Identificar","Error de Papeleria"],this.predictiveList=[],this.showDropdown=!1,this.isSelecting=!1,this.isSubmitting=!1,this.submitSuccess=!1,this.submitError="",this.successMessage=""}ngOnInit(){this.wineryNewsForm=this.fb.group({fechaNovedad:[this.getCurrentDate(),s.k0.required],tipoNovedad:["",s.k0.required],productReference:["",s.k0.required],cantidadProducto:[null,[s.k0.required,s.k0.min(1)]],detalleNovedad:["",[s.k0.required,s.k0.minLength(10)]]}),this.setupReferenceSearch()}getCurrentDate(){const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}onSubmit(){if(this.submitSuccess=!1,this.submitError="",this.successMessage="",this.wineryNewsForm.invalid)return console.error("El formulario no es v\xe1lido. Revise los campos obligatorios."),void this.wineryNewsForm.markAllAsTouched();const t=this.wineryNewsForm.getRawValue(),r=this.transformFormToRequest(t),i=this.newsServices.validateWarehouseNews(r);if(!i.valid)return console.error("\u274c Errores de validaci\xf3n:",i.errors),void(this.submitError=i.errors.join(", "));this.isSubmitting=!0,this.newsServices.createWarehouseNews(r).subscribe({next:a=>{this.isSubmitting=!1,this.submitSuccess=!0,this.successMessage=a.msg,setTimeout(()=>{this.resetForm(),this.submitSuccess=!1,this.successMessage=""},3e3)},error:a=>{console.error("\u274c Error al enviar novedad de bodega:",a),this.isSubmitting=!1,this.submitError=a.message||"Error desconocido al registrar la novedad de bodega",setTimeout(()=>{this.submitError=""},5e3)}})}transformFormToRequest(t){const[r,i,a]=t.fechaNovedad.split("-");return{newsDate:`${a}/${i}/${r}`,category:t.tipoNovedad,reference:t.productReference,reportedAmount:t.cantidadProducto.toString(),description:t.detalleNovedad}}resetForm(){this.wineryNewsForm.reset({fechaNovedad:this.getCurrentDate(),tipoNovedad:"",productReference:"",cantidadProducto:null,detalleNovedad:""}),this.wineryNewsForm.markAsUntouched(),this.wineryNewsForm.markAsPristine(),this.predictiveList=[],this.showDropdown=!1}isFieldInvalid(t){const r=this.wineryNewsForm.get(t);return r?.invalid&&(r?.dirty||r?.touched)}setupReferenceSearch(){this.wineryNewsForm.get("productReference")?.valueChanges.pipe((0,p.B)(300),(0,f.p)(()=>!this.isSelecting),(0,g.M)(t=>{const r=t.trim();console.log("\u{1f50d} T\xe9rmino de b\xfasqueda:",r),r.length<2&&(this.predictiveList=[],this.showDropdown=!1,console.log("\u274c T\xe9rmino muy corto, limpiando lista"))}),(0,f.p)(t=>t.trim().length>=2),(0,v.n)(t=>(console.log("\u{1f4e1} Buscando en backend:",t.trim()),this.dashboardService.searchReferences(t.trim())))).subscribe({next:t=>{console.log("\u2705 Respuesta del backend:",t),t.ok&&t.msg.length>0?(this.predictiveList=this.extractPredictiveValues(t.msg),this.showDropdown=!0,console.log("\u{1f4cb} Lista actualizada con",this.predictiveList.length,"items")):(this.predictiveList=[],this.showDropdown=!1,console.log("\u26a0\ufe0f Sin resultados"))},error:t=>{console.error("\u274c Error en b\xfasqueda:",t),this.predictiveList=[],this.showDropdown=!1}})}extractPredictiveValues(t){const r=new Set;return t.forEach(i=>{r.add(i.reference)}),Array.from(r)}selectReference(t){console.log("\u{1f3af} Seleccionando item:",t),this.isSelecting=!0,this.predictiveList=[],this.showDropdown=!1,this.wineryNewsForm.get("productReference")?.setValue(t,{emitEvent:!1}),this.wineryNewsForm.get("productReference")?.updateValueAndValidity(),setTimeout(()=>{this.isSelecting=!1,console.log("\u2705 Selecci\xf3n completada, bandera desactivada")},500),setTimeout(()=>{document.getElementById("cantidadProducto")?.focus()},100)}onBlur(){setTimeout(()=>{this.showDropdown=!1,this.predictiveList=[],console.log("\u{1f44b} onBlur: Dropdown oculto")},200)}onFocus(){if(this.isSelecting)return void console.log("\u26a0\ufe0f onFocus bloqueado: selecci\xf3n en proceso");const t=this.wineryNewsForm.get("productReference")?.value||"";this.predictiveList.length>0&&t.trim().length>=2&&(this.showDropdown=!0,console.log("\u{1f441}\ufe0f onFocus: Mostrando dropdown"))}clearDropdown(){this.predictiveList=[],this.showDropdown=!1,console.log("\u{1f9f9} Dropdown limpiado manualmente")}static{this.\u0275fac=function(r){return new(r||o)}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-winery-news"]],decls:45,vars:27,consts:[[1,"container-fluid","py-4"],[1,"card","bg-primary-subtle","text-dark","overflow-hidden"],[1,"card-body","p-4"],[1,"text-primary-darker","mb-1"],[1,"text-muted","mb-0"],[1,"card","shadow-lg","border-0"],[1,"card-body","p-4","p-md-5"],["class","alert-container mb-4",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-md-6"],["for","fechaNovedad",1,"form-label","text-muted"],["type","date","id","fechaNovedad","formControlName","fechaNovedad",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","tipoNovedad",1,"form-label","text-muted"],["id","tipoNovedad","formControlName","tipoNovedad",1,"form-select",3,"ngClass"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-6","position-relative"],["for","productReference",1,"form-label","text-muted"],["type","text","id","productReference","formControlName","productReference","placeholder","Escriba c\xf3digo o nombre de referencia","autocomplete","off",1,"form-control",3,"focus","blur","ngClass"],["class","autocomplete-results shadow-lg",4,"ngIf"],["for","cantidadProducto",1,"form-label","text-muted"],["type","number","id","cantidadProducto","formControlName","cantidadProducto","placeholder","Ingrese la cantidad",1,"form-control",3,"ngClass"],[1,"col-12"],["for","detalleNovedad",1,"form-label","text-muted"],["id","detalleNovedad","rows","3","formControlName","detalleNovedad","placeholder","Describa la novedad de forma clara y concisa (m\xednimo 10 caracteres).",1,"form-control",3,"ngClass"],[1,"col-12","mt-4","text-end"],["type","submit",1,"btn","btn-primary","btn-lg","shadow-sm",3,"disabled"],[4,"ngIf"],[1,"alert-container","mb-4"],["class","alert alert-success alert-dismissible fade show d-flex align-items-center shadow-sm","role","alert",4,"ngIf"],["class","alert alert-danger alert-dismissible fade show d-flex align-items-center shadow-sm","role","alert",4,"ngIf"],["class","alert alert-info alert-dismissible fade show d-flex align-items-center shadow-sm","role","alert",4,"ngIf"],["role","alert",1,"alert","alert-success","alert-dismissible","fade","show","d-flex","align-items-center","shadow-sm"],[1,"ti","ti-circle-check","fs-3","me-3"],[1,"flex-grow-1"],[1,"alert-heading","mb-1"],[1,"mb-0"],["type","button","aria-label","Close",1,"btn-close",3,"click"],["role","alert",1,"alert","alert-danger","alert-dismissible","fade","show","d-flex","align-items-center","shadow-sm"],[1,"ti","ti-alert-circle","fs-3","me-3"],["role","alert",1,"alert","alert-info","alert-dismissible","fade","show","d-flex","align-items-center","shadow-sm"],["role","status",1,"spinner-border","spinner-border-sm","text-info","me-3"],[1,"visually-hidden"],[1,"invalid-feedback"],[3,"value"],[1,"autocomplete-results","shadow-lg"],["class","autocomplete-item",3,"click",4,"ngFor","ngForOf"],[1,"autocomplete-item",3,"click"],[1,"ti","ti-send","me-2"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"]],template:function(r,i){1&r&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),e.EFF(4,"Registro de Novedades de Bodega"),e.k0s(),e.j41(5,"p",4),e.EFF(6,"Reportar incidentes o inconsistencias de producto en Bodega."),e.k0s()()(),e.j41(7,"div",5)(8,"div",6),e.DNE(9,N,4,3,"div",7),e.j41(10,"form",8),e.bIt("ngSubmit",function(){return i.onSubmit()}),e.j41(11,"div",9)(12,"div",10)(13,"label",11),e.EFF(14,"Fecha de Novedad (*)"),e.k0s(),e.nrm(15,"input",12),e.DNE(16,E,2,0,"div",13),e.k0s(),e.j41(17,"div",10)(18,"label",14),e.EFF(19,"Tipo de Novedad (*)"),e.k0s(),e.j41(20,"select",15)(21,"option",16),e.EFF(22,"Seleccione el tipo"),e.k0s(),e.DNE(23,y,2,2,"option",17),e.k0s(),e.DNE(24,R,2,0,"div",13),e.k0s(),e.j41(25,"div",18)(26,"label",19),e.EFF(27,"Referencia en Producci\xf3n (*)"),e.k0s(),e.j41(28,"input",20),e.bIt("focus",function(){return i.onFocus()})("blur",function(){return i.onBlur()}),e.k0s(),e.DNE(29,D,2,1,"div",21)(30,P,2,0,"div",13),e.k0s(),e.j41(31,"div",10)(32,"label",22),e.EFF(33,"Cantidad de Producto (*)"),e.k0s(),e.nrm(34,"input",23),e.DNE(35,C,2,0,"div",13),e.k0s(),e.j41(36,"div",24)(37,"label",25),e.EFF(38,"Detalle de Novedad (*)"),e.k0s(),e.nrm(39,"textarea",26),e.DNE(40,I,2,0,"div",13),e.k0s(),e.j41(41,"div",27)(42,"button",28),e.DNE(43,M,3,0,"span",29)(44,T,3,0,"span",29),e.k0s()()()()()()()),2&r&&(e.R7$(9),e.Y8G("ngIf",i.submitSuccess||i.submitError||i.isSubmitting),e.R7$(),e.Y8G("formGroup",i.wineryNewsForm),e.R7$(5),e.Y8G("ngClass",e.eq3(17,c,i.isFieldInvalid("fechaNovedad"))),e.R7$(),e.Y8G("ngIf",i.isFieldInvalid("fechaNovedad")),e.R7$(4),e.Y8G("ngClass",e.eq3(19,c,i.isFieldInvalid("tipoNovedad"))),e.R7$(3),e.Y8G("ngForOf",i.tiposNovedad),e.R7$(),e.Y8G("ngIf",i.isFieldInvalid("tipoNovedad")),e.R7$(4),e.Y8G("ngClass",e.eq3(21,c,i.isFieldInvalid("productReference"))),e.R7$(),e.Y8G("ngIf",i.predictiveList.length>0&&i.showDropdown),e.R7$(),e.Y8G("ngIf",i.isFieldInvalid("productReference")),e.R7$(4),e.Y8G("ngClass",e.eq3(23,c,i.isFieldInvalid("cantidadProducto"))),e.R7$(),e.Y8G("ngIf",i.isFieldInvalid("cantidadProducto")),e.R7$(4),e.Y8G("ngClass",e.eq3(25,c,i.isFieldInvalid("detalleNovedad"))),e.R7$(),e.Y8G("ngIf",i.isFieldInvalid("detalleNovedad")),e.R7$(2),e.Y8G("disabled",i.wineryNewsForm.invalid||i.isSubmitting),e.R7$(),e.Y8G("ngIf",!i.isSubmitting),e.R7$(),e.Y8G("ngIf",i.isSubmitting))},dependencies:[u.MD,u.YU,u.Sq,u.bT,s.X1,s.qT,s.xH,s.y7,s.me,s.Q0,s.wz,s.BC,s.cb,s.j4,s.JD],styles:['@charset "UTF-8";.autocomplete-results[_ngcontent-%COMP%]{position:absolute;z-index:1000;width:100%;max-height:250px;overflow-y:auto;background:#fff;border:1px solid #ddd;border-radius:6px;box-shadow:0 8px 16px #00000026}.autocomplete-item[_ngcontent-%COMP%]{padding:10px 15px;cursor:pointer;font-size:14px;color:#444;transition:background-color .2s,color .2s}.autocomplete-item[_ngcontent-%COMP%]:hover{background-color:#f5f5ff;color:var(--bs-primary, #007bff)}.alert-container[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideDown .3s ease-out}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.alert[_ngcontent-%COMP%]{border-left:4px solid}.alert.alert-success[_ngcontent-%COMP%]{border-left-color:#28a745;background-color:#d4edda;color:#155724}.alert.alert-success[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#28a745}.alert.alert-danger[_ngcontent-%COMP%]{border-left-color:#dc3545;background-color:#f8d7da;color:#721c24}.alert.alert-danger[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#dc3545}.alert.alert-info[_ngcontent-%COMP%]{border-left-color:#17a2b8;background-color:#d1ecf1;color:#0c5460}.alert.alert-info[_ngcontent-%COMP%]   .spinner-border[_ngcontent-%COMP%]{color:#17a2b8!important}.autocomplete-results[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;z-index:1000;background:#fff;border:1px solid #ddd;border-radius:4px;max-height:200px;overflow-y:auto;margin-top:2px}.autocomplete-item[_ngcontent-%COMP%]{padding:10px 15px;cursor:pointer;transition:background-color .2s}.autocomplete-item[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}']})}}return o})()}}]);