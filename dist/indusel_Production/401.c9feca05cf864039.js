"use strict";(self.webpackChunkfree_version=self.webpackChunkfree_version||[]).push([[401],{2401:(O,_,i)=>{i.r(_),i.d(_,{OrderPreparation:()=>m});var d=i(8728),s=i(2200),g=i(9417),u=i(3140),l=i(2288),e=i(3664);function b(a,p){if(1&a){const t=e.RV6();e.j41(0,"div",13)(1,"div",14)(2,"span",15),e.EFF(3),e.k0s(),e.j41(4,"span",16),e.EFF(5,"Items Totales"),e.k0s()(),e.j41(6,"div",14)(7,"span",15),e.EFF(8),e.k0s(),e.j41(9,"span",16),e.EFF(10,"Nro. Orden"),e.k0s()(),e.j41(11,"button",17),e.bIt("click",function(){d.eBV(t);const n=e.XpG();return d.Njj(n.exportToExcel())}),d.qSk(),e.j41(12,"svg",18),e.nrm(13,"path",19)(14,"polyline",20)(15,"path",21)(16,"path",22)(17,"path",23),e.k0s(),d.joV(),e.j41(18,"span"),e.EFF(19,"Descargar Excel"),e.k0s()()()}if(2&a){const t=e.XpG();e.R7$(3),e.JRh(t.orderData.barcode.length),e.R7$(5),e.JRh(t.orderData.loadingOrder),e.R7$(3),e.Y8G("disabled",t.loading)}}function f(a,p){if(1&a){const t=e.RV6();e.j41(0,"tr")(1,"td")(2,"strong"),e.EFF(3),e.k0s()(),e.j41(4,"td")(5,"span",31),e.EFF(6),e.k0s()(),e.j41(7,"td")(8,"div",32)(9,"button",33),e.bIt("click",function(){const n=d.eBV(t).$implicit,o=e.XpG(2);return d.Njj(o.markAsLoaded(n))}),e.EFF(10," Confirmar "),e.k0s(),e.j41(11,"input",34,0),e.bIt("input",function(){return d.eBV(t),d.Njj(0)})("keyup.enter",function(){const n=d.eBV(t).$implicit,o=e.sdS(12),c=e.XpG(2);return 27===o.value.length&&c.replaceCode(n,o.value),d.Njj(o.value="")}),e.k0s(),e.j41(13,"button",35),e.bIt("click",function(){const n=d.eBV(t).$implicit,o=e.sdS(12);return e.XpG(2).replaceCode(n,o.value),d.Njj(o.value="")}),e.j41(14,"span"),e.EFF(15),e.k0s()()()()()}if(2&a){const t=p.$implicit,r=e.sdS(12),n=e.XpG(2);e.R7$(3),e.JRh(t.code),e.R7$(2),e.Y8G("ngClass",t.loadBarcode?"ok":"pending"),e.R7$(),e.SpI(" ",t.loadBarcode?"CARGADO":"PENDIENTE"," "),e.R7$(3),e.Y8G("disabled",t.loadBarcode||n.loading),e.R7$(2),e.Y8G("disabled",t.loadBarcode||n.loading),e.R7$(2),e.Y8G("disabled",t.loadBarcode||n.loading||27!==r.value.length),e.R7$(2),e.JRh(n.loading?"...":"Reemplazar")}}function h(a,p){1&a&&(e.j41(0,"div",36),e.EFF(1," No hay c\xf3digos de barras pendientes en esta orden. "),e.k0s())}function x(a,p){if(1&a&&(e.j41(0,"div",6)(1,"div",24)(2,"span"),e.EFF(3),e.k0s(),e.nrm(4,"input",25),e.k0s(),e.j41(5,"div",26)(6,"table",27)(7,"thead")(8,"tr")(9,"th"),e.EFF(10,"C\xf3digo de Barras"),e.k0s(),e.j41(11,"th"),e.EFF(12,"Estado Cargue"),e.k0s(),e.j41(13,"th",28),e.EFF(14,"Acciones de Intervenci\xf3n"),e.k0s()()(),e.j41(15,"tbody"),e.DNE(16,f,16,7,"tr",29),e.k0s()()(),e.DNE(17,h,2,0,"div",30),e.k0s()),2&a){const t=e.XpG();e.R7$(3),e.SpI("Detalles de la Orden: ",t.orderData.authorization),e.R7$(13),e.Y8G("ngForOf",t.orderData.barcode),e.R7$(),e.Y8G("ngIf",0===t.orderData.barcode.length)}}let m=(()=>{class a{constructor(){this.inventorySvc=(0,d.WQX)(u.B),this.fb=(0,d.WQX)(g.ok),this.selectedFile=null,this.orderData=null,this.loading=!1}ngOnInit(){this.buildForm(),this.loadOrder()}buildForm(){this.uploadForm=this.fb.group({file:[null,g.k0.required]})}onFileSelected(t){const r=t.target;r.files&&r.files.length>0&&(this.selectedFile=r.files[0],this.uploadForm.patchValue({file:this.selectedFile}))}uploadFile(){this.selectedFile?(this.loading=!0,this.inventorySvc.updateOrder(this.selectedFile).subscribe({next:t=>{console.log("Respuesta backend:",t),this.selectedFile=null,this.uploadForm.reset(),this.loadOrder(),alert("Archivo cargado con \xe9xito")},error:t=>{this.loading=!1,alert("Error al cargar: "+t.message)}})):alert("Por favor, selecciona un archivo primero.")}loadOrder(){this.inventorySvc.viewOrder().subscribe({next:t=>{this.orderData=t.data,this.loading=!1},error:()=>{this.loading=!1}})}markAsLoaded(t){const r={_id:t._id,code:t.code,loadBarcode:!0};this.loading=!0,this.inventorySvc.updateOrderItems(r).subscribe({next:n=>{t.loadBarcode=!0,this.loading=!1,console.log("Item confirmado exitosamente")},error:()=>this.loading=!1})}replaceCode(t,r){if(!r||0===r.trim().length)return void alert("El c\xf3digo no puede estar vac\xedo");const n={_id:t._id,code:r.trim(),codeRead:!0};this.loading=!0,this.inventorySvc.updateBarcodeReadController(n).subscribe({next:o=>{t.code=r.trim(),t.loadBarcode=!0,t.codeRead=!0,this.loading=!1,console.log("Respuesta:",o.msg)},error:o=>{this.loading=!1,alert("No se pudo reemplazar el c\xf3digo: "+o.message)}})}exportToExcel(){if(!this.orderData||!this.orderData.barcode.length)return void alert("No hay datos para exportar");const t=this.orderData.barcode.map(c=>({"C\xd3DIGO DE BARRAS":c.code,ESTADO:c.loadBarcode?"CARGADO":"PENDIENTE"})),r=l.Wp.json_to_sheet(t),n=l.Wp.book_new();l.Wp.book_append_sheet(n,r,"C\xf3digos de Barras"),l._h(n,`Orden_${this.orderData.loadingOrder}_Barcodes.xlsx`)}static{this.\u0275fac=function(r){return new(r||a)}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-order-preparation"]],decls:19,vars:4,consts:[["newCode",""],[1,"main-container"],[1,"blue-header"],[1,"header-content"],[1,"info"],["class","stats-container",4,"ngIf"],[1,"modern-card"],[1,"card-header-gray"],[1,"card-body"],[1,"d-flex","align-items-center","gap-3"],["type","file","accept",".sal",1,"form-control","w-50",3,"change"],[1,"btn-primary-modern",3,"click","disabled"],["class","modern-card",4,"ngIf"],[1,"stats-container"],[1,"stat-card"],[1,"val"],[1,"label"],[1,"btn-excel",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"],["points","14 2 14 8 20 8"],["d","M8 13l2 3 2-3"],["d","M12 16l2-3"],["d","M8 16l2-3"],[1,"card-header-gray","d-flex","justify-content-between","align-items-center"],["type","text","placeholder","Filtrar por c\xf3digo...",1,"input-modern",2,"width","250px"],[1,"table-container"],[1,"modern-table"],[2,"width","400px"],[4,"ngFor","ngForOf"],["class","p-4 text-center text-muted",4,"ngIf"],[1,"badge-status",3,"ngClass"],[1,"d-flex","gap-2","align-items-center"],[1,"btn-primary-modern","btn-sm",2,"padding","6px 12px","background-color","#10b981",3,"click","disabled"],["type","text","placeholder","Nuevo \xedtem...",1,"input-modern",2,"width","140px","height","35px",3,"input","keyup.enter","disabled"],[1,"btn-primary-modern","btn-sm",2,"padding","6px 12px","background-color","#64748b",3,"click","disabled"],[1,"p-4","text-center","text-muted"]],template:function(r,n){1&r&&(e.j41(0,"div",1)(1,"header",2)(2,"div",3)(3,"div",4)(4,"h2"),e.EFF(5,"Validaci\xf3n de pedidos"),e.k0s(),e.j41(6,"p"),e.EFF(7,"Reporte consolidado para el cargue y validaci\xf3n de productos de salida."),e.k0s()()(),e.DNE(8,b,20,3,"div",5),e.k0s(),e.j41(9,"div",6)(10,"div",7),e.EFF(11,"Cargue de archivo de preparaci\xf3n (.sal)"),e.k0s(),e.j41(12,"div",8)(13,"div",9)(14,"input",10),e.bIt("change",function(c){return n.onFileSelected(c)}),e.k0s(),e.j41(15,"button",11),e.bIt("click",function(){return n.uploadFile()}),e.j41(16,"span"),e.EFF(17),e.k0s()()()()(),e.DNE(18,x,18,3,"div",12),e.k0s()),2&r&&(e.R7$(8),e.Y8G("ngIf",n.orderData),e.R7$(7),e.Y8G("disabled",!n.selectedFile||n.loading),e.R7$(2),e.JRh(n.loading?"Procesando...":"Cargar Archivo"),e.R7$(),e.Y8G("ngIf",n.orderData))},dependencies:[s.MD,s.YU,s.Sq,s.bT,g.X1],styles:['@charset "UTF-8";.main-container[_ngcontent-%COMP%]{padding:24px;background-color:#f3f4f6;min-height:100vh}.blue-header[_ngcontent-%COMP%]{background:linear-gradient(90deg,#0b3c6f,#072a4f);color:#fff;padding:32px;border-radius:16px;margin-bottom:24px;box-shadow:0 10px 15px -3px #0000001a}.blue-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.blue-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:26px;font-weight:700;margin:0}.blue-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;opacity:.8;margin-top:8px;max-width:600px}.blue-header[_ngcontent-%COMP%]   .stats-container[_ngcontent-%COMP%]{display:flex;gap:16px;margin-top:24px}.blue-header[_ngcontent-%COMP%]   .stats-container[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]{background:#ffffff1a;border:1px solid rgba(255,255,255,.2);padding:12px 20px;border-radius:12px;backdrop-filter:blur(4px);display:flex;align-items:center;gap:12px}.blue-header[_ngcontent-%COMP%]   .stats-container[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .val[_ngcontent-%COMP%]{font-size:20px;font-weight:700}.blue-header[_ngcontent-%COMP%]   .stats-container[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:12px;opacity:.9;text-transform:uppercase;letter-spacing:.5px}.modern-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;border:none;box-shadow:0 4px 6px -1px #0000000d;margin-bottom:24px;overflow:hidden}.modern-card[_ngcontent-%COMP%]   .card-header-gray[_ngcontent-%COMP%]{background-color:#f8fafc;padding:16px 24px;border-bottom:1px solid #e2e8f0;font-weight:600;color:#334155}.modern-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:24px}.modern-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.modern-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;padding:12px 16px;background:#f1f5f9;color:#475569;font-size:12px;text-transform:uppercase;font-weight:600}.modern-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:16px;border-bottom:1px solid #f1f5f9;font-size:14px;vertical-align:middle}.modern-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f8fafc}.input-modern[_ngcontent-%COMP%]{border:1px solid #e2e8f0;border-radius:8px;padding:8px 12px;outline:none;transition:border .2s}.input-modern[_ngcontent-%COMP%]:focus{border-color:#0b3c6f}.btn-primary-modern[_ngcontent-%COMP%]{background-color:#0b3c6f;color:#fff;border:none;padding:10px 20px;border-radius:8px;font-weight:500;cursor:pointer;transition:background .2s}.btn-primary-modern[_ngcontent-%COMP%]:hover{background-color:#082d54}.btn-primary-modern[_ngcontent-%COMP%]:disabled{background-color:#cbd5e1;cursor:not-allowed}.badge-status[_ngcontent-%COMP%]{padding:4px 12px;border-radius:20px;font-size:11px;font-weight:700}.badge-status.ok[_ngcontent-%COMP%]{background:#dcfce7;color:#15803d}.badge-status.pending[_ngcontent-%COMP%]{background:#fee2e2;color:#b91c1c}.stats-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-top:24px;width:100%}.stats-container[_ngcontent-%COMP%]   .btn-excel[_ngcontent-%COMP%]{margin-left:auto;background-color:#10b981;color:#fff;border:none;padding:10px 18px;border-radius:10px;font-weight:600;display:flex;align-items:center;gap:8px;cursor:pointer;transition:all .2s ease;box-shadow:0 4px 6px -1px #0000001a}.stats-container[_ngcontent-%COMP%]   .btn-excel[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0;stroke:#fff}.stats-container[_ngcontent-%COMP%]   .btn-excel[_ngcontent-%COMP%]:hover{background-color:#059669;transform:translateY(-2px);box-shadow:0 6px 12px #00000026}.stats-container[_ngcontent-%COMP%]   .btn-excel[_ngcontent-%COMP%]:active{transform:translateY(0)}.stats-container[_ngcontent-%COMP%]   .btn-excel[_ngcontent-%COMP%]:disabled{background-color:#94a3b8;cursor:not-allowed;transform:none}']})}}return a})()}}]);