"use strict";(self.webpackChunkfree_version=self.webpackChunkfree_version||[]).push([[574],{4574:(j,m,d)=>{d.r(m),d.d(m,{ReadBarcode:()=>P});var l=d(8728),p=d(2200),a=d(9417),f=d(152),_=d(5964),g=d(7468),h=d(7758),e=d(3664);function b(r,c){if(1&r){const t=e.RV6();e.j41(0,"li",32),e.EFF(1),e.j41(2,"button",33),e.bIt("click",function(){const n=l.eBV(t).index,s=e.XpG(3);return l.Njj(s.removeSerial(s.serialsToReprint,n))}),e.nrm(3,"i",34),e.k0s()()}if(2&r){const t=c.$implicit;e.R7$(),e.SpI(" ",t," ")}}function v(r,c){if(1&r&&(e.j41(0,"div",15)(1,"label"),e.EFF(2),e.k0s(),e.j41(3,"ul",30),e.DNE(4,b,4,1,"li",31),e.k0s()()),2&r){const t=e.XpG(2);e.R7$(2),e.SpI("Seriales en cola (",t.serialsToReprint.length,")"),e.R7$(2),e.Y8G("ngForOf",t.serialsToReprint)}}function R(r,c){if(1&r&&(e.j41(0,"div",35),e.EFF(1),e.k0s()),2&r){const t=e.XpG(2);e.Y8G("ngClass","alert-"+t.serverMessage.type),e.R7$(),e.SpI(" ",t.serverMessage.text," ")}}function F(r,c){1&r&&e.nrm(0,"span",36)}function C(r,c){if(1&r){const t=e.RV6();e.j41(0,"div")(1,"h3"),e.EFF(2,"Reimprimir Etiquetas"),e.k0s(),e.j41(3,"p",13),e.EFF(4,"Escanee las etiquetas. La informaci\xf3n se enviar\xe1 al backend para su registro."),e.k0s(),e.j41(5,"form",14),e.bIt("ngSubmit",function(){l.eBV(t);const n=e.XpG();return l.Njj(n.onReimprimirSubmit())}),e.j41(6,"div",15)(7,"label"),e.EFF(8,"Escanear Serial (*)"),e.k0s(),e.j41(9,"input",16),e.bIt("keydown.enter",function(n){return l.eBV(t),l.Njj(n.preventDefault())}),e.k0s()(),e.DNE(10,v,5,2,"div",17),e.j41(11,"div",18)(12,"div",19)(13,"label"),e.EFF(14,"Responsable de Reimpresi\xf3n (*)"),e.k0s(),e.nrm(15,"input",20),e.k0s(),e.j41(16,"div",21)(17,"div",22),e.nrm(18,"input",23),e.j41(19,"label",24),e.EFF(20,"\xbfRetorn\xf3 etiqueta f\xedsica?"),e.k0s()()()(),e.j41(21,"div",15)(22,"label"),e.EFF(23,"Motivo (*)"),e.k0s(),e.nrm(24,"input",25),e.k0s(),e.DNE(25,R,2,2,"div",26),e.j41(26,"div",27)(27,"button",28),e.DNE(28,F,1,0,"span",29),e.EFF(29," Procesar Reimpresi\xf3n "),e.k0s()()()()}if(2&r){let t;const i=e.XpG();e.R7$(5),e.Y8G("formGroup",i.reprintForm),e.R7$(4),e.Y8G("placeholder",null!=(t=i.cancelForm.get("fastCancel"))&&t.value?"Escanee para anular al instante...":"Escanee para la lista..."),e.R7$(),e.Y8G("ngIf",i.serialsToReprint.length>0),e.R7$(15),e.Y8G("ngIf",i.serverMessage),e.R7$(2),e.Y8G("disabled",i.reprintForm.invalid||0===i.serialsToReprint.length||i.isLoading),e.R7$(),e.Y8G("ngIf",i.isLoading)}}function x(r,c){if(1&r){const t=e.RV6();e.j41(0,"li",47),e.EFF(1),e.j41(2,"button",33),e.bIt("click",function(){const n=l.eBV(t).index,s=e.XpG(3);return l.Njj(s.removeSerial(s.serialsToCancel,n))}),e.nrm(3,"i",34),e.k0s()()}if(2&r){const t=c.$implicit;e.R7$(),e.SpI(" ",t," ")}}function E(r,c){if(1&r&&(e.j41(0,"div",15)(1,"label"),e.EFF(2),e.k0s(),e.j41(3,"ul",30),e.DNE(4,x,4,1,"li",46),e.k0s()()),2&r){const t=e.XpG(2);e.R7$(2),e.SpI("Seriales en cola (",t.serialsToCancel.length,")"),e.R7$(2),e.Y8G("ngForOf",t.serialsToCancel)}}function M(r,c){if(1&r&&(e.j41(0,"div",35),e.EFF(1),e.k0s()),2&r){const t=e.XpG(2);e.Y8G("ngClass","alert-"+t.serverMessage.type),e.R7$(),e.SpI(" ",t.serverMessage.text," ")}}function k(r,c){1&r&&e.nrm(0,"div",27)}function O(r,c){if(1&r){const t=e.RV6();e.j41(0,"div")(1,"div",37)(2,"h3"),e.EFF(3,"Anular Etiquetas"),e.k0s(),e.j41(4,"div",38),e.nrm(5,"input",39),e.j41(6,"label",40)(7,"strong"),e.EFF(8,"Anulaci\xf3n R\xe1pida (Auto-env\xedo)"),e.k0s()()()(),e.j41(9,"p",13),e.EFF(10),e.k0s(),e.j41(11,"form",14),e.bIt("ngSubmit",function(){l.eBV(t);const n=e.XpG();return l.Njj(n.onAnularSubmit())}),e.j41(12,"div",15)(13,"label"),e.EFF(14,"Escanear Serial (*)"),e.k0s(),e.nrm(15,"input",41),e.k0s(),e.DNE(16,E,5,2,"div",17),e.j41(17,"div",18)(18,"div",19)(19,"label"),e.EFF(20,"Responsable de Anulaci\xf3n (*)"),e.k0s(),e.nrm(21,"input",20),e.k0s(),e.j41(22,"div",21)(23,"div",22),e.nrm(24,"input",42),e.j41(25,"label",43),e.EFF(26,"\xbfRetorn\xf3 etiqueta f\xedsica?"),e.k0s()()()(),e.j41(27,"div",15)(28,"label"),e.EFF(29,"Motivo de Anulaci\xf3n (*)"),e.k0s(),e.nrm(30,"input",44),e.k0s(),e.DNE(31,M,2,2,"div",26)(32,k,1,0,"div",45),e.k0s()()}if(2&r){let t,i,n,s;const o=e.XpG();e.R7$(5),e.Y8G("formControl",o.cancelForm.get("fastCancel")),e.R7$(5),e.SpI(" ",null!=(t=o.cancelForm.get("fastCancel"))&&t.value?"Modo R\xe1pido: Llene los campos de abajo y escanee para procesar al instante.":"Modo Manual: Escanee para listar y luego presione el bot\xf3n Procesar."," "),e.R7$(),e.Y8G("formGroup",o.cancelForm),e.R7$(4),e.Y8G("placeholder",null!=(i=o.cancelForm.get("fastCancel"))&&i.value?"Escanee para anular al instante...":"Escanee para agregar a la lista..."),e.R7$(),e.Y8G("ngIf",o.serialsToCancel.length>0&&!(null!=(n=o.cancelForm.get("fastCancel"))&&n.value)),e.R7$(15),e.Y8G("ngIf",o.serverMessage),e.R7$(),e.Y8G("ngIf",!(null!=(s=o.cancelForm.get("fastCancel"))&&s.value))}}let P=(()=>{class r{constructor(){this.fb=(0,l.WQX)(a.ok),this.printingService=(0,l.WQX)(h.e),this.activeView="reimprimir",this.serialsToReprint=[],this.serialsToCancel=[],this.isLoading=!1,this.serverMessage=null,this.readResult=null,this.pendingLabels=[],this.validatedLabels=[],this.reprintForm=this.fb.group({serialEntry:[""],reason:["",[a.k0.required,a.k0.minLength(5)]],personReprints:["",[a.k0.required]],ReturnLabelOld:[!0,[a.k0.required]]}),this.cancelForm=this.fb.group({serialEntry:[""],reason:["",[a.k0.required,a.k0.minLength(10)]]}),this.readForm=this.fb.group({serial:["",a.k0.required]}),this.validationForm=this.fb.group({serialToValidate:["",a.k0.required]}),this.cancelForm=this.fb.group({serialEntry:[""],reason:["",[a.k0.required,a.k0.minLength(10)]],personReprints:["",[a.k0.required]],ReturnLabelOld:[!0,[a.k0.required]],fastCancel:[!1]})}ngOnInit(){this.setupScanListener(this.reprintForm.get("serialEntry"),this.serialsToReprint),this.setupScanListener(this.cancelForm.get("serialEntry"),this.serialsToCancel)}setupScanListener(t,i){t.valueChanges.pipe((0,f.B)(80),(0,_.p)(n=>!!n&&n.trim().length>0)).subscribe(n=>{const s=n.trim();"anular"===this.activeView&&this.cancelForm.get("fastCancel")?.value?this.handleFastCancel(s):i.includes(s)||i.unshift(s),t.patchValue("",{emitEvent:!1})})}handleFastCancel(t){const{reason:i,personReprints:n,ReturnLabelOld:s}=this.cancelForm.value;this.cancelForm.get("reason")?.invalid||this.cancelForm.get("personReprints")?.invalid?this.serverMessage={type:"danger",text:"\u26a0\ufe0f Campos incompletos: Debe ingresar el Responsable y un Motivo v\xe1lido (m\xedn. 10 carac.) antes de escanear."}:(this.isLoading=!0,this.serverMessage=null,this.printingService.labelRemove({code:t,note:i,personReprints:n,ReturnLabelOld:s}).subscribe({next:u=>{this.isLoading=!1,this.serverMessage={type:"success",text:`Etiqueta ${t} anulada correctamente.`}},error:u=>{this.isLoading=!1,this.serverMessage={type:"danger",text:u.message}}}))}setView(t){this.activeView=t,this.serverMessage=null,this.reprintForm.reset({ReturnLabelOld:!0}),this.cancelForm.reset(),this.serialsToReprint=[],this.serialsToCancel=[]}removeSerial(t,i){t.splice(i,1)}onReimprimirSubmit(){if(this.reprintForm.invalid||0===this.serialsToReprint.length)return;this.isLoading=!0,this.serverMessage=null;const{reason:t,personReprints:i,ReturnLabelOld:n}=this.reprintForm.value,s=this.serialsToReprint.map(o=>this.printingService.reprintLabel({code:o,note:t,personReprints:i,ReturnLabelOld:n}));(0,g.p)(s).subscribe({next:o=>{this.isLoading=!1,this.serverMessage={type:"success",text:`${o.length} etiquetas reimpresas con \xe9xito.`},this.serialsToReprint=[],this.reprintForm.reset({ReturnLabelOld:!0})},error:o=>{this.isLoading=!1,this.serverMessage={type:"danger",text:o.message}}})}onAnularSubmit(){if(this.cancelForm.invalid||0===this.serialsToCancel.length)return;this.isLoading=!0,this.serverMessage=null;const{reason:t,personReprints:i,ReturnLabelOld:n}=this.cancelForm.value,s=this.serialsToCancel.map(o=>this.printingService.labelRemove({code:o,note:t,personReprints:i,ReturnLabelOld:n}));(0,g.p)(s).subscribe({next:o=>{this.isLoading=!1,this.serverMessage={type:"success",text:`${o.length} etiquetas anuladas exitosamente.`},this.serialsToCancel=[],this.cancelForm.reset({ReturnLabelOld:!0})},error:o=>{this.isLoading=!1,this.serverMessage={type:"danger",text:o.message}}})}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-read-barcode"]],decls:26,vars:11,consts:[[1,"inventory-container"],[1,"header"],[1,"main-content"],[1,"left-panel"],[1,"list-group"],["type","button",1,"list-group-item","list-group-item-action",3,"click"],[1,"feather","icon-printer","me-2"],[1,"feather","icon-slash","me-2"],[1,"feather","icon-eye","me-2"],[1,"feather","icon-check-circle","me-2"],[1,"right-panel"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"text-muted"],[3,"ngSubmit","formGroup"],[1,"form-group"],["type","text","formControlName","serialEntry",1,"form-control",3,"keydown.enter","placeholder"],["class","form-group",4,"ngIf"],[1,"row"],[1,"col-md-7","form-group"],["type","text","formControlName","personReprints","placeholder","Nombre de quien autoriza",1,"form-control"],[1,"col-md-5","form-group","d-flex","align-items-end"],[1,"form-check","form-switch","mb-2"],["type","checkbox","id","retorno","formControlName","ReturnLabelOld",1,"form-check-input"],["for","retorno",1,"form-check-label"],["type","text","formControlName","reason","placeholder","Ej: Error de impresi\xf3n, da\xf1o f\xedsico",1,"form-control"],["class","alert mt-2",3,"ngClass",4,"ngIf"],[1,"button-group","d-flex","justify-content-end"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[1,"list-group","validation-list",2,"height","120px"],["class","list-group-item d-flex justify-content-between",4,"ngFor","ngForOf"],[1,"list-group-item","d-flex","justify-content-between"],["type","button",1,"btn","btn-sm","btn-link","text-danger",3,"click"],[1,"feather","icon-trash-2"],[1,"alert","mt-2",3,"ngClass"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"d-flex","justify-content-between","align-items-center"],[1,"form-check","form-switch"],["type","checkbox","id","fastCancel",1,"form-check-input",3,"formControl"],["for","fastCancel",1,"form-check-label"],["type","text","formControlName","serialEntry",1,"form-control",3,"placeholder"],["type","checkbox","id","retornoAnular","formControlName","ReturnLabelOld",1,"form-check-input"],["for","retornoAnular",1,"form-check-label"],["type","text","formControlName","reason","placeholder","Ej: Error de digitaci\xf3n, etiqueta da\xf1ada",1,"form-control"],["class","button-group d-flex justify-content-end",4,"ngIf"],["class","list-group-item d-flex justify-content-between align-items-center",4,"ngFor","ngForOf"],[1,"list-group-item","d-flex","justify-content-between","align-items-center"]],template:function(i,n){1&i&&(e.j41(0,"div",0)(1,"header",1)(2,"h1"),e.EFF(3,"Gesti\xf3n de Etiquetas"),e.k0s()(),e.j41(4,"div",2)(5,"div",3)(6,"h4"),e.EFF(7,"Acciones"),e.k0s(),e.nrm(8,"hr"),e.j41(9,"div",4)(10,"button",5),e.bIt("click",function(){return n.setView("reimprimir")}),e.nrm(11,"i",6),e.EFF(12," Reimprimir "),e.k0s(),e.j41(13,"button",5),e.bIt("click",function(){return n.setView("anular")}),e.nrm(14,"i",7),e.EFF(15," Anular "),e.k0s(),e.j41(16,"button",5),e.bIt("click",function(){return n.setView("leer")}),e.nrm(17,"i",8),e.EFF(18," Leer Etiquetas "),e.k0s(),e.j41(19,"button",5),e.bIt("click",function(){return n.setView("validar")}),e.nrm(20,"i",9),e.EFF(21," Validar Etiquetas "),e.k0s()()(),e.j41(22,"div",10)(23,"div",11),e.DNE(24,C,30,6,"div",12)(25,O,33,7,"div",12),e.k0s()()()()),2&i&&(e.R7$(10),e.AVh("active","reimprimir"===n.activeView),e.R7$(3),e.AVh("active","anular"===n.activeView),e.R7$(3),e.AVh("active","leer"===n.activeView),e.R7$(3),e.AVh("active","validar"===n.activeView),e.R7$(4),e.Y8G("ngSwitch",n.activeView),e.R7$(),e.Y8G("ngSwitchCase","reimprimir"),e.R7$(),e.Y8G("ngSwitchCase","anular"))},dependencies:[p.MD,p.YU,p.Sq,p.bT,p.ux,p.e1,a.X1,a.qT,a.me,a.Zm,a.BC,a.cb,a.l_,a.j4,a.JD],styles:['@import"https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap";@charset "UTF-8";.inventory-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh;font-family:Inter,sans-serif;background:#f5f7fa}.header[_ngcontent-%COMP%]{background:linear-gradient(90deg,#87d1e6,#036);color:#fff;padding:1.5rem 2rem;text-align:center;font-weight:600;font-size:1.8rem;box-shadow:0 4px 8px #0000001f}.main-content[_ngcontent-%COMP%]{flex:1;display:flex;padding:2rem;gap:2rem;max-width:1400px;margin:0 auto;width:100%}.left-panel[_ngcontent-%COMP%]{flex:0 0 300px;background:#fff;border-radius:12px;padding:1.2rem 0;box-shadow:0 8px 20px #0000000f;height:fit-content}.left-panel[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{padding:0 1.2rem}.left-panel[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{margin:1rem 0}.left-panel[_ngcontent-%COMP%]   .list-group[_ngcontent-%COMP%]{border-radius:0}.left-panel[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%]{border-radius:0;border-left:none;border-right:none;border-top:1px solid #eee;padding:.9rem 1.2rem}.left-panel[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%]:first-child{border-top:none}.right-panel[_ngcontent-%COMP%]{flex:1 1 auto;background:#fff;border-radius:12px;padding:1.5rem 2rem;box-shadow:0 8px 20px #0000000f}.left-panel[_ngcontent-%COMP%]   .list-group-item.active[_ngcontent-%COMP%]{background-color:#036;color:#fff;border-color:#036;font-weight:600;border-left:4px solid #87D1E6}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}label[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.5rem;display:block;color:#4b6cb7}.form-control[_ngcontent-%COMP%]{border-radius:8px;padding:.7rem .9rem;border:1px solid #d6dde8}.button-group[_ngcontent-%COMP%]{display:flex;gap:.8rem;margin-top:.6rem}.btn[_ngcontent-%COMP%]{padding:.65rem 1rem;border-radius:8px;font-weight:600}@media (max-width: 900px){.main-content[_ngcontent-%COMP%]{flex-direction:column;padding:1rem}.left-panel[_ngcontent-%COMP%]{flex:1 1 auto;max-width:100%}}.results-card[_ngcontent-%COMP%]{background:#fdfdfd;border:1px solid #eef4ff;border-radius:8px;padding:1.5rem;box-shadow:0 4px 12px #00000008}.results-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-top:0;margin-bottom:1rem;color:#036;border-bottom:1px solid #eee;padding-bottom:.5rem}.results-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;gap:.8rem 1rem}.results-grid[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#4b6cb7}.results-grid[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500}.results-grid[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.85rem}.validation-lists-container[_ngcontent-%COMP%]{display:flex;gap:2rem;margin-top:1.5rem}.validation-lists-container[_ngcontent-%COMP%]   .list-column[_ngcontent-%COMP%]{flex:1;min-width:200px}.validation-lists-container[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{color:#555;font-weight:600}.validation-list[_ngcontent-%COMP%]{height:300px;overflow-y:auto;border:1px solid #d6dde8;border-radius:8px;background:#fbfdff}.validation-list[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%]{font-family:Roboto Mono,monospace;font-size:.9rem;padding:.6rem 1rem}.validation-list[_ngcontent-%COMP%]   .list-group-item-warning[_ngcontent-%COMP%]{color:#664d03}.validation-list[_ngcontent-%COMP%]   .list-group-item-success[_ngcontent-%COMP%]{color:#0f5132;font-weight:600}@media (max-width: 768px){.validation-lists-container[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}}']})}}return r})()}}]);