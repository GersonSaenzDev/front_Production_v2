"use strict";(self.webpackChunkfree_version=self.webpackChunkfree_version||[]).push([[457],{3140:(A,F,c)=>{c.d(F,{B:()=>v});var b=c(8728),R=c(9330),T=c(8810),i=c(9437),t=c(2525);let v=(()=>{class C{constructor(){this.http=(0,b.WQX)(R.Qq),this.BASE_URL=t.c.backendUrl,this.BASE_API=t.c.api,this.SEE_GROUPS_ENDPOINT=`${this.BASE_URL}${this.BASE_API}/storage/seeGroups`,this.CONFIRMED_COUNT_ENDPOINT=`${this.BASE_URL}${this.BASE_API}/storage/confirmedCount`,this.DUPLICATES_ENDPOINT=`${this.BASE_URL}${this.BASE_API}/storage/duplicates`,this.GLOBALCOUNT_ENDPOINT=`${this.BASE_URL}${this.BASE_API}/storage/countGlobal`,this.GLOBALCOUNT_TEAMCOUNT=`${this.BASE_URL}${this.BASE_API}/storage/teamCount`,this.GLOBALCOUNT_AREACOUNT=`${this.BASE_URL}${this.BASE_API}/storage/areaCount`,this.GLOBALCOUNT_VIEWINVENTORIES=`${this.BASE_URL}${this.BASE_API}/storage/viewInventories`,this.GLOBALCOUNT_TEAMITEMS=`${this.BASE_URL}${this.BASE_API}/storage/TeamItems`,this.GLOBALCOUNT_NOTCOMPLIANT=`${this.BASE_URL}${this.BASE_API}/storage/notCompliant`,this.GLOBALCOUNT_AUDITNOTE=`${this.BASE_URL}${this.BASE_API}/storage/auditNote`,this.GLOBALCOUNT_STORAGE=`${this.BASE_URL}${this.BASE_API}/storage`,this.GLOBALCOUNT_INSERTINVENTORY=`${this.BASE_URL}${this.BASE_API}/storage/insertInventory`}handleError(h){console.error("DashInventoryServices: Error en la petici\xf3n:",h);let l="Ocurri\xf3 un error desconocido en el servicio.";return h.error&&h.er?.msg?l=h.error.msg:h.message&&(l=h.message),(0,T.$)(()=>new Error(`Fall\xf3 la consulta al backend: ${l}`))}getStorageGroups(h){return this.http.post(this.SEE_GROUPS_ENDPOINT,{date:h}).pipe((0,i.W)(this.handleError.bind(this)))}getConfirmedCount(h){return this.http.post(this.CONFIRMED_COUNT_ENDPOINT,{date:h}).pipe((0,i.W)(this.handleError.bind(this)))}getDuplicates(h){return this.http.post(this.DUPLICATES_ENDPOINT,{date:h}).pipe((0,i.W)(this.handleError.bind(this)))}getCountGlobal(h){return this.http.post(this.GLOBALCOUNT_ENDPOINT,{date:h}).pipe((0,i.W)(this.handleError.bind(this)))}getTeamCount(h){return this.http.post(this.GLOBALCOUNT_TEAMCOUNT,{date:h}).pipe((0,i.W)(this.handleError.bind(this)))}getAreaCount(h){return this.http.post(this.GLOBALCOUNT_AREACOUNT,{date:h}).pipe((0,i.W)(this.handleError.bind(this)))}getViewInventories(h,l=100,I=1){return this.http.post(this.GLOBALCOUNT_VIEWINVENTORIES,{date:h,limit:l,page:I}).pipe((0,i.W)(this.handleError.bind(this)))}getTeamItems(h,l){const I={date:h,...l};return this.http.post(this.GLOBALCOUNT_TEAMITEMS,I).pipe((0,i.W)(this.handleError.bind(this)))}getNotCompliant(h,l){const I={date:h,...l};return this.http.post(this.GLOBALCOUNT_NOTCOMPLIANT,I).pipe((0,i.W)(this.handleError.bind(this)))}getAuditNote(h){return this.http.post(this.GLOBALCOUNT_AUDITNOTE,h).pipe((0,i.W)(this.handleError.bind(this)))}getStorage(h){return this.http.post(this.GLOBALCOUNT_STORAGE,h).pipe((0,i.W)(this.handleError.bind(this)))}getInsertInventory(h){return this.http.post(this.GLOBALCOUNT_INSERTINVENTORY,h).pipe((0,i.W)(this.handleError.bind(this)))}static{this.\u0275fac=function(l){return new(l||C)}}static{this.\u0275prov=b.jDH({token:C,factory:C.\u0275fac,providedIn:"root"})}}return C})()},5457:(A,F,c)=>{c.r(F),c.d(F,{WarehouseModule:()=>h});var b=c(2200),R=c(8132),T=c(8101),i=c(3664),t=c(8728);const v=[{path:"",component:T.DashInventories,children:[{path:"dash",loadComponent:()=>Promise.resolve().then(c.bind(c,8101)).then(l=>l.DashInventories)}]},{path:"checkNews",loadComponent:()=>c.e(899).then(c.bind(c,1899)).then(l=>l.CheckNews)},{path:"configInventories",loadComponent:()=>c.e(109).then(c.bind(c,4109)).then(l=>l.ConfigureInventories)},{path:"enterInventory",loadComponent:()=>c.e(7).then(c.bind(c,4007)).then(l=>l.InventoryReader)}];let C=(()=>{class l{static{this.\u0275fac=function(D){return new(D||l)}}static{this.\u0275mod=i.$C({type:l})}static{this.\u0275inj=t.G2t({imports:[R.iI.forChild(v),R.iI]})}}return l})();var N=c(8652);let h=(()=>{class l{static{this.\u0275fac=function(D){return new(D||l)}}static{this.\u0275mod=i.$C({type:l})}static{this.\u0275inj=t.G2t({imports:[b.MD,N.oi,C]})}}return l})()},8101:(A,F,c)=>{c.r(F),c.d(F,{DashInventories:()=>Z});var b=c(467),R=c(177),T=c(4799),i=c(8728),t=c(3664),v=c(4341),C=c(8810),N=c(3140),h=c(2389),l=c(2200);function I(a,m){if(1&a&&(t.j41(0,"option",62),t.EFF(1),t.k0s()),2&a){const e=m.$implicit;t.Y8G("value",e),t.R7$(),t.JRh(e)}}function j(a,m){if(1&a&&(t.j41(0,"option",62),t.EFF(1),t.k0s()),2&a){const e=m.$implicit;t.Y8G("value",e.key),t.R7$(),t.JRh(e.label)}}function D(a,m){if(1&a){const e=t.RV6();t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s(),t.j41(11,"td",60)(12,"button",63),t.bIt("click",function(){const n=i.eBV(e).$implicit,s=t.XpG(2);return i.Njj(s.openAnnotationModal(n))}),t.nrm(13,"i",64),t.k0s()()()}if(2&a){const e=m.$implicit,o=t.XpG(2);t.R7$(2),t.JRh(e.code),t.R7$(2),t.JRh(e.codRef),t.R7$(2),t.JRh(e.referencia),t.R7$(2),t.JRh(e.area),t.R7$(2),t.JRh(e.teamLabel||o.computeTeamKey(e))}}function O(a,m){1&a&&(t.j41(0,"tr")(1,"td",65),t.EFF(2,"No hay registros para la fecha seleccionada"),t.k0s()())}function M(a,m){if(1&a){const e=t.RV6();t.j41(0,"div")(1,"div",48)(2,"div",49)(3,"input",50),t.mxI("ngModelChange",function(n){i.eBV(e);const s=t.XpG();return t.DH7(s.filterText,n)||(s.filterText=n),i.Njj(n)}),t.bIt("ngModelChange",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.applyGlobalFilters())}),t.k0s()(),t.j41(4,"div",49)(5,"select",51),t.mxI("ngModelChange",function(n){i.eBV(e);const s=t.XpG();return t.DH7(s.filterArea,n)||(s.filterArea=n),i.Njj(n)}),t.bIt("change",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.applyGlobalFilters())}),t.j41(6,"option",52),t.EFF(7,"Todas las \xc1reas"),t.k0s(),t.DNE(8,I,2,2,"option",53),t.k0s()(),t.j41(9,"div",49)(10,"select",51),t.mxI("ngModelChange",function(n){i.eBV(e);const s=t.XpG();return t.DH7(s.filterTeam,n)||(s.filterTeam=n),i.Njj(n)}),t.bIt("change",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.applyGlobalFilters())}),t.j41(11,"option",52),t.EFF(12,"Todos los Equipos"),t.k0s(),t.DNE(13,j,2,2,"option",53),t.k0s()(),t.j41(14,"div",54)(15,"button",55),t.bIt("click",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.resetGlobalFilters())}),t.EFF(16,"Reset"),t.k0s(),t.j41(17,"button",56),t.bIt("click",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.loadAllData(n.formatDateForBackend(n.selectedDate)))}),t.EFF(18,"Refrescar"),t.k0s()()(),t.j41(19,"div",57)(20,"table",58)(21,"thead",59)(22,"tr")(23,"th"),t.EFF(24,"C\xf3digo"),t.k0s(),t.j41(25,"th"),t.EFF(26,"CodRef"),t.k0s(),t.j41(27,"th"),t.EFF(28,"Referencia"),t.k0s(),t.j41(29,"th"),t.EFF(30,"\xc1rea"),t.k0s(),t.j41(31,"th"),t.EFF(32,"Equipo"),t.k0s(),t.j41(33,"th",60),t.EFF(34,"Anotaciones"),t.k0s()()(),t.j41(35,"tbody"),t.DNE(36,D,14,5,"tr",61)(37,O,3,0,"tr",46),t.k0s()()()()}if(2&a){const e=t.XpG();t.R7$(3),t.R50("ngModel",e.filterText),t.R7$(2),t.R50("ngModel",e.filterArea),t.R7$(3),t.Y8G("ngForOf",e.areaOptions),t.R7$(2),t.R50("ngModel",e.filterTeam),t.R7$(3),t.Y8G("ngForOf",e.teamOptions),t.R7$(23),t.Y8G("ngForOf",e.filteredInventory),t.R7$(),t.Y8G("ngIf",0===e.filteredInventory.length)}}function x(a,m){if(1&a&&(t.j41(0,"option",62),t.EFF(1),t.k0s()),2&a){const e=m.$implicit;t.Y8G("value",e.key),t.R7$(),t.Lme("",e.label," \u2014 ",e.area)}}function L(a,m){if(1&a&&(t.j41(0,"option",62),t.EFF(1),t.k0s()),2&a){const e=m.$implicit;t.Y8G("value",e.key),t.R7$(),t.Lme("",e.label," \u2014 ",e.area)}}function B(a,m){if(1&a){const e=t.RV6();t.j41(0,"button",75),t.bIt("click",function(){i.eBV(e);const n=t.XpG(2);return i.Njj(n.exportComparison())}),t.nrm(1,"i",76),t.EFF(2," Exportar Diferencias "),t.k0s()}}function G(a,m){if(1&a&&(t.j41(0,"tr")(1,"td",85)(2,"strong"),t.EFF(3),t.k0s()(),t.j41(4,"td")(5,"small"),t.EFF(6),t.k0s()()()),2&a){const e=m.$implicit;t.R7$(3),t.JRh(e.code),t.R7$(3),t.JRh(e.referencia)}}function $(a,m){1&a&&(t.j41(0,"tr")(1,"td",86),t.EFF(2,"\xa1Todo coincide! No hay faltantes."),t.k0s()())}function P(a,m){if(1&a&&(t.j41(0,"tr")(1,"td",87)(2,"strong"),t.EFF(3),t.k0s()(),t.j41(4,"td")(5,"small"),t.EFF(6),t.k0s()()()),2&a){const e=m.$implicit;t.R7$(3),t.JRh(e.code),t.R7$(3),t.JRh(e.referencia)}}function S(a,m){1&a&&(t.j41(0,"tr")(1,"td",86),t.EFF(2,"\xa1Todo coincide! No hay faltantes."),t.k0s()())}function w(a,m){if(1&a&&(t.j41(0,"div",0)(1,"div",67)(2,"div",77)(3,"div",78)(4,"span"),t.EFF(5,"Solo en Equipo A (Faltan en B)"),t.k0s(),t.j41(6,"span",79),t.EFF(7),t.k0s()(),t.j41(8,"div",80)(9,"table",81)(10,"thead")(11,"tr")(12,"th"),t.EFF(13,"C\xf3digo"),t.k0s(),t.j41(14,"th"),t.EFF(15,"Referencia"),t.k0s()()(),t.j41(16,"tbody"),t.DNE(17,G,7,2,"tr",61)(18,$,3,0,"tr",46),t.k0s()()()()(),t.j41(19,"div",67)(20,"div",82)(21,"div",83)(22,"span"),t.EFF(23,"Solo en Equipo B (Faltan en A)"),t.k0s(),t.j41(24,"span",84),t.EFF(25),t.k0s()(),t.j41(26,"div",80)(27,"table",81)(28,"thead")(29,"tr")(30,"th"),t.EFF(31,"C\xf3digo"),t.k0s(),t.j41(32,"th"),t.EFF(33,"Referencia"),t.k0s()()(),t.j41(34,"tbody"),t.DNE(35,P,7,2,"tr",61)(36,S,3,0,"tr",46),t.k0s()()()()()()),2&a){const e=t.XpG(2);t.R7$(7),t.JRh(e.comparisonDetails.leftMissing.length),t.R7$(10),t.Y8G("ngForOf",e.comparisonDetails.leftMissing),t.R7$(),t.Y8G("ngIf",0===e.comparisonDetails.leftMissing.length),t.R7$(7),t.JRh(e.comparisonDetails.rightMissing.length),t.R7$(10),t.Y8G("ngForOf",e.comparisonDetails.rightMissing),t.R7$(),t.Y8G("ngIf",0===e.comparisonDetails.rightMissing.length)}}function U(a,m){if(1&a){const e=t.RV6();t.j41(0,"div")(1,"div",66)(2,"div",67)(3,"div",68)(4,"select",51),t.mxI("ngModelChange",function(n){i.eBV(e);const s=t.XpG();return t.DH7(s.selectedTeamLeft,n)||(s.selectedTeamLeft=n),i.Njj(n)}),t.bIt("change",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.onSelectTeam("left"))}),t.j41(5,"option",52),t.EFF(6,"Equipo A (Referencia)"),t.k0s(),t.DNE(7,x,2,3,"option",53),t.k0s(),t.j41(8,"button",69),t.bIt("click",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.clearTeam("left"))}),t.EFF(9,"Limpiar"),t.k0s()()(),t.j41(10,"div",67)(11,"div",68)(12,"select",51),t.mxI("ngModelChange",function(n){i.eBV(e);const s=t.XpG();return t.DH7(s.selectedTeamRight,n)||(s.selectedTeamRight=n),i.Njj(n)}),t.bIt("change",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.onSelectTeam("right"))}),t.j41(13,"option",52),t.EFF(14,"Equipo B (Validaci\xf3n)"),t.k0s(),t.DNE(15,L,2,3,"option",53),t.k0s(),t.j41(16,"button",69),t.bIt("click",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.clearTeam("right"))}),t.EFF(17,"Limpiar"),t.k0s()()()(),t.j41(18,"div",70)(19,"button",71),t.bIt("click",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.compareTeams())}),t.nrm(20,"i",72),t.EFF(21," Ejecutar Cruce de Inventario "),t.k0s(),t.DNE(22,B,3,0,"button",73),t.k0s(),t.DNE(23,w,37,6,"div",74),t.k0s()}if(2&a){const e=t.XpG();t.R7$(4),t.R50("ngModel",e.selectedTeamLeft),t.R7$(3),t.Y8G("ngForOf",e.teamOptions),t.R7$(5),t.R50("ngModel",e.selectedTeamRight),t.R7$(3),t.Y8G("ngForOf",e.teamOptions),t.R7$(4),t.Y8G("disabled",!e.teamLeft||!e.teamRight),t.R7$(3),t.Y8G("ngIf",e.comparisonResult),t.R7$(),t.Y8G("ngIf",e.comparisonDetails)}}function V(a,m){if(1&a&&(t.j41(0,"option",62),t.EFF(1),t.k0s()),2&a){const e=m.$implicit;t.Y8G("value",e),t.R7$(),t.JRh(e)}}function X(a,m){if(1&a&&(t.j41(0,"option",62),t.EFF(1),t.k0s()),2&a){const e=m.$implicit;t.Y8G("value",e.key),t.R7$(),t.JRh(e.label)}}function Y(a,m){1&a&&(t.j41(0,"span"),t.EFF(1,", "),t.k0s())}function W(a,m){if(1&a&&(t.j41(0,"span"),t.EFF(1),t.DNE(2,Y,2,0,"span",46),t.k0s()),2&a){const e=m.$implicit,o=m.last;t.R7$(),t.SpI(" ",e),t.R7$(),t.Y8G("ngIf",!o)}}function J(a,m){if(1&a){const e=t.RV6();t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s(),t.j41(11,"td"),t.EFF(12),t.k0s(),t.j41(13,"td"),t.DNE(14,W,3,2,"span",61),t.k0s(),t.j41(15,"td",60)(16,"button",63),t.bIt("click",function(){const n=i.eBV(e).$implicit,s=t.XpG(2);return i.Njj(s.openAnnotationModal(n))}),t.nrm(17,"i",64),t.k0s()()()}if(2&a){const e=m.$implicit;t.R7$(2),t.JRh(e.code),t.R7$(2),t.JRh(e.codRef),t.R7$(2),t.JRh(e.referencia),t.R7$(2),t.JRh(e.producto),t.R7$(2),t.JRh(e.area),t.R7$(2),t.JRh(e.team||"Sin equipo"),t.R7$(2),t.Y8G("ngForOf",e.persons)}}function K(a,m){1&a&&(t.j41(0,"tr")(1,"td",91),t.EFF(2,"No hay registros no conformes para la fecha seleccionada"),t.k0s()())}function H(a,m){if(1&a){const e=t.RV6();t.j41(0,"div",92)(1,"button",93),t.bIt("click",function(){i.eBV(e);const n=t.XpG(2);return i.Njj(n.changeNotCompliantPage(n.notCompliantCurrentPage-1))}),t.EFF(2," Anterior "),t.k0s(),t.j41(3,"button",94),t.EFF(4),t.k0s(),t.j41(5,"button",93),t.bIt("click",function(){i.eBV(e);const n=t.XpG(2);return i.Njj(n.changeNotCompliantPage(n.notCompliantCurrentPage+1))}),t.EFF(6," Siguiente "),t.k0s()()}if(2&a){const e=t.XpG(2);t.R7$(),t.Y8G("disabled",e.notCompliantCurrentPage<=1),t.R7$(3),t.Lme(" P\xe1gina ",e.notCompliantCurrentPage," de ",e.notCompliantTotalPages," "),t.R7$(),t.Y8G("disabled",e.notCompliantCurrentPage>=e.notCompliantTotalPages)}}function z(a,m){if(1&a){const e=t.RV6();t.j41(0,"div")(1,"div",48)(2,"div",49)(3,"input",50),t.mxI("ngModelChange",function(n){i.eBV(e);const s=t.XpG();return t.DH7(s.filterTextNotCompliant,n)||(s.filterTextNotCompliant=n),i.Njj(n)}),t.bIt("ngModelChange",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.applyNotCompliantFilters())}),t.k0s()(),t.j41(4,"div",49)(5,"select",51),t.mxI("ngModelChange",function(n){i.eBV(e);const s=t.XpG();return t.DH7(s.filterAreaNotCompliant,n)||(s.filterAreaNotCompliant=n),i.Njj(n)}),t.bIt("change",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.applyNotCompliantFilters())}),t.j41(6,"option",52),t.EFF(7,"Todas las \xc1reas"),t.k0s(),t.DNE(8,V,2,2,"option",53),t.k0s()(),t.j41(9,"div",49)(10,"select",51),t.mxI("ngModelChange",function(n){i.eBV(e);const s=t.XpG();return t.DH7(s.filterTeamNotCompliant,n)||(s.filterTeamNotCompliant=n),i.Njj(n)}),t.bIt("change",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.applyNotCompliantFilters())}),t.j41(11,"option",52),t.EFF(12,"Todos los Equipos"),t.k0s(),t.DNE(13,X,2,2,"option",53),t.k0s()(),t.j41(14,"div",54)(15,"button",55),t.bIt("click",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.resetNotCompliantFilters())}),t.EFF(16,"Reset"),t.k0s(),t.j41(17,"button",56),t.bIt("click",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.loadNotCompliantData(n.formatDateForBackend(n.selectedDate)))}),t.EFF(18,"Refrescar"),t.k0s()()(),t.j41(19,"div",57)(20,"table",58)(21,"thead",59)(22,"tr")(23,"th"),t.EFF(24,"C\xf3digo"),t.k0s(),t.j41(25,"th"),t.EFF(26,"CodRef"),t.k0s(),t.j41(27,"th"),t.EFF(28,"Referencia"),t.k0s(),t.j41(29,"th"),t.EFF(30,"Producto"),t.k0s(),t.j41(31,"th"),t.EFF(32,"\xc1rea"),t.k0s(),t.j41(33,"th"),t.EFF(34,"Equipo"),t.k0s(),t.j41(35,"th"),t.EFF(36,"Personas"),t.k0s(),t.j41(37,"th",60),t.EFF(38,"Anotaciones"),t.k0s()()(),t.j41(39,"tbody"),t.DNE(40,J,18,7,"tr",61)(41,K,3,0,"tr",46),t.k0s()()(),t.j41(42,"div",88)(43,"div",89),t.EFF(44),t.k0s(),t.DNE(45,H,7,4,"div",90),t.k0s()()}if(2&a){const e=t.XpG();t.R7$(3),t.R50("ngModel",e.filterTextNotCompliant),t.R7$(2),t.R50("ngModel",e.filterAreaNotCompliant),t.R7$(3),t.Y8G("ngForOf",e.areaOptions),t.R7$(2),t.R50("ngModel",e.filterTeamNotCompliant),t.R7$(3),t.Y8G("ngForOf",e.teamOptions),t.R7$(27),t.Y8G("ngForOf",e.filteredNotCompliantItems),t.R7$(),t.Y8G("ngIf",0===e.filteredNotCompliantItems.length),t.R7$(3),t.Lme(" Mostrando ",e.filteredNotCompliantItems.length," de ",e.notCompliantTotal," registros no conformes "),t.R7$(),t.Y8G("ngIf",e.notCompliantTotalPages>1)}}function Q(a,m){if(1&a){const e=t.RV6();t.j41(0,"div",95)(1,"div",96)(2,"div",41)(3,"div",97)(4,"strong"),t.EFF(5,"Anotaci\xf3n - C\xf3digo:"),t.k0s(),t.j41(6,"small",98),t.EFF(7),t.k0s(),t.j41(8,"button",99),t.bIt("click",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.closeAnnotationModal())}),t.k0s()(),t.j41(9,"div",3)(10,"p",100)(11,"small",89),t.EFF(12),t.k0s()(),t.j41(13,"div",101)(14,"label",102),t.EFF(15,"Anotaci\xf3n"),t.k0s(),t.j41(16,"textarea",103),t.mxI("ngModelChange",function(n){i.eBV(e);const s=t.XpG();return t.DH7(s.annotationText,n)||(s.annotationText=n),i.Njj(n)}),t.k0s()(),t.j41(17,"div",104)(18,"button",105),t.bIt("click",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.closeAnnotationModal())}),t.EFF(19,"Cancelar"),t.k0s(),t.j41(20,"button",106),t.bIt("click",function(){i.eBV(e);const n=t.XpG();return i.Njj(n.saveAnnotation())}),t.EFF(21,"Guardar"),t.k0s()()()()()()}if(2&a){const e=t.XpG();t.R7$(7),t.JRh(null==e.annotationItem?null:e.annotationItem.code),t.R7$(5),t.Lme("Referencia: ",null==e.annotationItem?null:e.annotationItem.referencia," \u2014 \xc1rea: ",null==e.annotationItem?null:e.annotationItem.area),t.R7$(4),t.R50("ngModel",e.annotationText)}}(0,R.EO)(T.A,"es");let Z=(()=>{class a{constructor(){this.dashboardService=(0,i.WQX)(N.B),this.selectedDate=this.formatDate(new Date),this.storageGroupsData=[],this.confirmedCountData=[],this.duplicatesData=[],this.productosLeidosCount=0,this.equiposRegistradosCount=0,this.duplicadosCount=0,this.productosOkCount=0,this.noConformesCount=0,this.revisionesCount=0,this.configuracionesCount=0,this.bloqueosCount=0,this.globalCount=0,this.validatedTrueCount=0,this.validatedFalseCount=0,this.teamCount=0,this.areaCount=0,this.notCompliantTotal=0,this.notCompliantTotalPages=0,this.notCompliantCurrentPage=1,this.notCompliantPageSize=20,this.notCompliantItems=[],this.notCompliantLoading=!1,this.notCompliantError="",this.filteredNotCompliantItems=[],this.filterTextNotCompliant="",this.filterAreaNotCompliant="",this.filterTeamNotCompliant="",this.showAnnotationModal=!1,this.annotationItem=null,this.annotationText="",this.panel="global",this.globalSearch="",this.filterText="",this.filterArea="",this.filterTeam="",this.areaOptions=[],this.teamOptions=[],this.loading=!1,this.errorMessage="",this.inventoryList=[],this.filteredInventory=[],this.p=1,this.itemsPerPage=10,this.selectedTeamLeft="",this.selectedTeamRight="",this.teamLeft=null,this.teamRight=null,this.comparisonResult=null,this.comparisonDetails=null,this.loadAllData(this.formatDateForBackend(this.selectedDate))}formatDate(e){const o=new Date(e);let n=""+(o.getMonth()+1),s=""+o.getDate();const r=o.getFullYear();return n.length<2&&(n="0"+n),s.length<2&&(s="0"+s),[r,n,s].join("-")}formatDateForBackend(e){const o="string"==typeof e?new Date(e.replace(/-/g,"/")):e;let n=""+o.getDate(),s=""+(o.getMonth()+1);const r=o.getFullYear();return s.length<2&&(s="0"+s),n.length<2&&(n="0"+n),[n,s,r].join("/")}onDateChange(e){const o=this.formatDateForBackend(e);this.loadAllData(o)}loadAllData(e){var o=this;return(0,b.A)(function*(){o.loading=!0,o.errorMessage="",o.inventoryList=[],o.resetCounts();try{const n=yield o.dashboardService.getViewInventories(e,100,1).toPromise();if(n?.ok&&n.msg){let s=[...n.msg.items];const r=n.msg.totalPages;if(r>1){const _=[];for(let f=2;f<=r;f++)_.push(o.dashboardService.getViewInventories(e,100,f).toPromise());(yield Promise.all(_)).forEach(f=>{f?.ok&&f.msg&&(s=[...s,...f.msg.items])})}const p=new Map,d=new Set;let g=0,u=0,E=0;o.inventoryList=s.map(_=>{const k=Array.isArray(_.persons)?_.persons.filter(Boolean):[],f=`${_.area||""}||${k.join("|")}`,y=k.length?`${_.area} \u2014 ${k.join(", ")}`:_.area||"Equipo sin nombre";return!0===_.validate&&g++,!1===_.validate&&u++,_.area&&d.add(_.area),(_.annotation||_.note)&&E++,p.has(f)||p.set(f,{key:f,label:y,area:_.area}),{..._,teamKey:f,teamLabel:y}}),o.globalCount=o.inventoryList.length,o.validatedTrueCount=g,o.validatedFalseCount=u,o.teamCount=p.size,o.areaCount=d.size,o.revisionesCount=u,o.configuracionesCount=E,o.teamOptions=Array.from(p.values()),o.areaOptions=Array.from(d).sort(),o.filteredInventory=[...o.inventoryList]}}catch(n){o.errorMessage="Error al obtener la lista completa de equipos.",console.error(n)}finally{o.loading=!1}})()}applyGlobalFilters(){const e=(this.filterText||"").toLowerCase();this.filteredInventory=this.inventoryList.filter(o=>{const n=!e||String(o.code||"").toLowerCase().includes(e)||String(o.referencia||"").toLowerCase().includes(e)||String(o.producto||"").toLowerCase().includes(e)||String(o.codRef||"").toLowerCase().includes(e),s=!this.filterArea||o.area===this.filterArea,r=!this.filterTeam||this.computeTeamKey(o)===this.filterTeam;return n&&s&&r})}onGlobalFilterChange(){this.applyGlobalFilters()}resetGlobalFilters(){this.filterText="",this.filterArea="",this.filterTeam="",this.filteredInventory=[...this.inventoryList]}computeTeamKey(e){const o=Array.isArray(e.persons)?e.persons.filter(Boolean):[];return`${e.area||""}||${o.join("|")}`}onSelectTeam(e){const o="left"===e?this.selectedTeamLeft:this.selectedTeamRight;if(!o)return"left"===e?this.teamLeft=null:this.teamRight=null,void(this.comparisonDetails=null);const n=this.inventoryList.filter(r=>this.computeTeamKey(r)===o),s={area:n.length>0?n[0].area:"",total:n.length,items:n};"left"===e?this.teamLeft={...s,codes:n.map(r=>r.code)}:this.teamRight={...s,codes:n.map(r=>r.code)},this.comparisonResult=null,this.comparisonDetails=null}clearTeam(e){"left"===e?(this.selectedTeamLeft="",this.teamLeft=null):(this.selectedTeamRight="",this.teamRight=null),this.comparisonResult=null}compareTeams(){if(!this.teamLeft||!this.teamRight)return void(this.comparisonResult=null);const e=this.teamLeft.items,o=this.teamRight.items,n=new Set(this.teamLeft.codes),s=new Set(this.teamRight.codes),r=e.filter(g=>!s.has(g.code)),p=o.filter(g=>!n.has(g.code)),d=e.filter(g=>s.has(g.code));this.comparisonDetails={leftMissing:r,rightMissing:p,matches:d},this.comparisonResult={matchCount:d.length,diffCount:r.length+p.length}}exportComparison(){if(!this.teamLeft||!this.teamRight)return;const e=this.teamLeft.codes.reduce((u,E)=>(u[E]=(u[E]||0)+1,u),{}),o=this.teamRight.codes.reduce((u,E)=>(u[E]=(u[E]||0)+1,u),{}),r=["code,leftCount,rightCount",...Array.from(new Set([...Object.keys(e),...Object.keys(o)])).map(u=>`${u},${e[u]||0},${o[u]||0}`)].join("\n"),p=new Blob([r],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(p),g=document.createElement("a");g.href=d,g.download=`comparison_${Date.now()}.csv`,g.click(),URL.revokeObjectURL(d)}resetCounts(){this.productosLeidosCount=0,this.equiposRegistradosCount=0,this.duplicadosCount=0,this.productosOkCount=0,this.noConformesCount=0,this.revisionesCount=0,this.validatedTrueCount=0,this.validatedFalseCount=0,this.globalCount=0,this.teamCount=0,this.areaCount=0}openAnnotationModal(e){this.annotationItem=e,this.annotationText=e?.annotation??e?.note??"",this.showAnnotationModal=!0}closeAnnotationModal(){this.showAnnotationModal=!1,this.annotationItem=null,this.annotationText=""}saveAnnotation(){if(!this.annotationItem)return;const e=(this.annotationText||"").trim();e!==(this.annotationItem.annotation??this.annotationItem.note??"")?this.sendAuditNoteForItem({code:this.annotationItem.code,referencia:this.annotationItem.referencia,area:this.annotationItem.area},e):this.closeAnnotationModal()}isSimpleResponse(e){return!!e&&"string"==typeof e.msg}isWithItemResponse(e){return!!e&&e.msg&&"object"==typeof e.msg&&("code"in e.msg||"_id"in e.msg)}sendAuditNoteForItem(e,o){const n=this.formatDateForBackend(this.selectedDate),s={barcode:e.code,reference:e.referencia,area:e.area,note:o,date:n};this.notCompliantLoading=!0,this.dashboardService.getAuditNote(s).subscribe({next:r=>{if(!r||!r.ok)return console.warn("Respuesta no OK del backend:",r),void(this.notCompliantLoading=!1);const p=this.notCompliantItems.find(d=>String(d.code)===String(s.barcode));if(this.isSimpleResponse(r))p&&(p.annotation=s.note??p.annotation),console.log(r.msg);else if(this.isWithItemResponse(r)){const d=r.msg;console.log("Respuesta con item actualizado:",d),p?(p.annotation=d.annotation??d.note??s.note??p.annotation,p.area=d.area??p.area,p.referencia=d.referencia??p.referencia,p.producto=d.producto??p.producto,p.validate="boolean"==typeof d.validate?d.validate:p.validate,p.codRef="number"==typeof d.codRef?d.codRef:p.codRef,p.persons=Array.isArray(d.persons)?d.persons:p.persons,p.team=d.team??p.team):this.notCompliantItems.push({_id:d._id,area:d.area,persons:d.persons||[],team:d.team||"",code:d.code,codRef:d.codRef,referencia:d.referencia,producto:d.producto,validate:d.validate,annotation:d.annotation??d.note}),console.log("Item actualizado:",d)}else p&&(p.annotation=s.note??p.annotation),console.warn("Respuesta con formato inesperado:",r);this.applyNotCompliantFilters(),this.closeAnnotationModal(),this.notCompliantLoading=!1},error:r=>{console.error("Error al guardar anotaci\xf3n:",r),this.notCompliantLoading=!1}})}loadNotCompliantData(e,o=1,n=20){this.dashboardService.getNotCompliant(e,{teamKey:"all",page:o,limit:n}).subscribe({next:r=>{r&&r.ok&&r.msg?(this.notCompliantTotal=r.msg.total??0,this.notCompliantTotalPages=r.msg.totalPages??0,this.notCompliantCurrentPage=r.msg.currentPage??o,this.notCompliantItems=r.msg.items??[],this.applyNotCompliantFilters()):this.resetNotCompliantData()},error:r=>{console.error("Error getNotCompliant:",r),this.errorMessage=r?.message||"Error cargando items no conformes",this.resetNotCompliantData()}})}resetNotCompliantData(){this.notCompliantTotal=0,this.notCompliantTotalPages=0,this.notCompliantCurrentPage=1,this.notCompliantItems=[],this.filteredNotCompliantItems=[]}applyNotCompliantFilters(){const e=(this.filterTextNotCompliant||"").trim().toLowerCase();this.filteredNotCompliantItems=this.notCompliantItems.filter(o=>(!e||(o.code||"").toLowerCase().includes(e)||(o.referencia||"").toLowerCase().includes(e)||(o.producto||"").toLowerCase().includes(e))&&(!this.filterAreaNotCompliant||o.area===this.filterAreaNotCompliant)&&(!this.filterTeamNotCompliant||o.team===this.filterTeamNotCompliant))}resetNotCompliantFilters(){this.filterTextNotCompliant="",this.filterAreaNotCompliant="",this.filterTeamNotCompliant="",this.applyNotCompliantFilters()}changeNotCompliantPage(e){if(!e||e<1||this.notCompliantTotalPages&&e>this.notCompliantTotalPages)return;const o=this.formatDateForBackend(this.selectedDate);this.loadNotCompliantData(o,e,this.notCompliantPageSize)}handleError(e){console.error("DashInventoryServices: Error en la petici\xf3n:",e);let o="Ocurri\xf3 un error inesperado.";return e.error?o=e.error.msg||e.error.message||o:e.message&&(o=e.message),(0,C.$)(()=>new Error(o))}clearErrorMessage(){this.errorMessage=""}static{this.\u0275fac=function(o){return new(o||a)}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-dash-inventories"]],features:[t.Jv_([{provide:t.xe9,useValue:"es"}])],decls:123,vars:23,consts:[[1,"row"],[1,"col-12","mb-4"],[1,"card","bg-primary-subtle","text-dark","overflow-hidden"],[1,"card-body"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"mb-1"],[1,"text-muted","mb-0","opacity-75","text-sm"],[1,"col-12","col-md-3"],["type","date",1,"form-control",3,"ngModelChange","change","ngModel"],[1,"row","mb-4"],[1,"col-md-3","mb-3"],[1,"card","total-income-card","overflow-hidden","bg-primary","text-white"],[1,"d-flex","align-items-center"],[1,"avatar","avatar-lg","icon","m-r-5"],[1,"text-white","ti","ti-layout-board-split","f-24"],[1,"ms-2"],[1,"text-white","f-w-600","mb-1"],[1,"mb-0","opacity-50","text-sm"],[1,"card","total-income-card","warning","overflow-hidden"],[1,"avatar","avatar-lg","icon-warning","m-r-5"],[1,"text-warning","ti","ti-layout-board-split","f-24"],[1,"f-w-600","mb-1"],[1,"card","total-income-card","danger","overflow-hidden","bg-danger","text-white"],[1,"avatar","avatar-lg","icon-danger","m-r-5"],[1,"text-white","ti","ti-alert-circle","f-24"],[1,"card","total-income-card","success","overflow-hidden","bg-success","text-white"],[1,"avatar","avatar-lg","icon-success","m-r-5"],[1,"text-white","ti","ti-check","f-24"],[1,"card","total-income-card","info","overflow-hidden","bg-info","text-white"],[1,"avatar","avatar-lg","icon-info","m-r-5"],[1,"text-white","ti","ti-info-circle","f-24"],[1,"card","total-income-card","warning","overflow-hidden","bg-warning","text-dark"],[1,"text-dark","ti","ti-exclamation","f-24"],[1,"card","total-income-card","secondary","overflow-hidden","bg-secondary","text-white"],[1,"avatar","avatar-lg","icon-secondary","m-r-5"],[1,"text-white","ti","ti-settings","f-24"],[1,"card","total-income-card","dark","overflow-hidden","bg-dark","text-white"],[1,"avatar","avatar-lg","icon-dark","m-r-5"],[1,"text-white","ti","ti-lock","f-24"],[1,"row","mt-4"],[1,"col-12"],[1,"card"],[1,"card-header","d-flex","align-items-center","justify-content-between"],[1,"list-group","list-group-horizontal","mb-0"],[1,"list-group-item",3,"click"],["type","text","placeholder","Buscar r\xe1pido (c\xf3digo, ref, producto)",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[4,"ngIf"],["class","annotation-modal-backdrop",4,"ngIf"],[1,"row","mb-3","g-2"],[1,"col-md-3"],["type","text","placeholder","Buscar c\xf3digo / referencia / producto",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-3","d-flex"],[1,"btn","btn-sm","btn-outline-primary","me-2",3,"click"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"table-responsive"],[1,"table","table-sm","table-hover"],[1,"table-light"],[1,"text-center"],[4,"ngFor","ngForOf"],[3,"value"],["title","Agregar / ver anotaci\xf3n",1,"btn","btn-sm","btn-outline-secondary",3,"click"],[1,"ti","ti-note"],["colspan","6",1,"text-center","text-muted"],[1,"row","mb-3"],[1,"col-md-6"],[1,"mb-2","d-flex","align-items-center","gap-2"],[1,"btn","btn-sm","btn-outline-secondary",3,"click"],[1,"d-flex","gap-2","mb-4"],[1,"btn","btn-primary",3,"click","disabled"],[1,"ti","ti-arrows-diff","me-1"],["class","btn btn-outline-success",3,"click",4,"ngIf"],["class","row",4,"ngIf"],[1,"btn","btn-outline-success",3,"click"],[1,"ti","ti-download","me-1"],[1,"card","border-danger"],[1,"card-header","bg-danger","text-white","d-flex","justify-content-between"],[1,"badge","bg-white","text-danger"],[1,"table-responsive",2,"max-height","400px"],[1,"table","table-sm","table-hover","mb-0"],[1,"card","border-warning"],[1,"card-header","bg-warning","text-dark","d-flex","justify-content-between"],[1,"badge","bg-dark","text-white"],[1,"text-danger"],["colspan","2",1,"text-center","text-success"],[1,"text-warning"],[1,"d-flex","justify-content-between","align-items-center","mt-3"],[1,"text-muted"],["class","btn-group","role","group",4,"ngIf"],["colspan","8",1,"text-center","text-muted"],["role","group",1,"btn-group"],[1,"btn","btn-outline-primary","btn-sm",3,"click","disabled"],[1,"btn","btn-primary","btn-sm","disabled"],[1,"annotation-modal-backdrop"],[1,"annotation-modal","dialog-card"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"text-muted","ms-2"],["type","button","aria-label","Cerrar",1,"btn-close",3,"click"],[1,"mb-2"],[1,"mb-3"],[1,"form-label"],["rows","6","placeholder","Escribe tu nota aqu\xed...",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-end","gap-2"],[1,"btn","btn-outline-secondary",3,"click"],[1,"btn","btn-primary",3,"click"]],template:function(o,n){1&o&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div")(6,"h4",5),t.EFF(7,"Consultar Inventario \u{1f4e6} por Fecha \u{1f4c5}"),t.k0s(),t.j41(8,"p",6),t.EFF(9," Fecha Seleccionada: "),t.j41(10,"strong"),t.EFF(11),t.nI1(12,"date"),t.k0s()()(),t.j41(13,"div",7)(14,"input",8),t.mxI("ngModelChange",function(r){return t.DH7(n.selectedDate,r)||(n.selectedDate=r),r}),t.bIt("change",function(){return n.onDateChange(n.selectedDate)}),t.k0s()()()()()()(),t.j41(15,"div",9)(16,"div",10)(17,"div",11)(18,"div",3)(19,"div",12)(20,"div",13),t.nrm(21,"i",14),t.k0s(),t.j41(22,"div",15)(23,"h4",16),t.EFF(24),t.k0s(),t.j41(25,"p",17),t.EFF(26,"Total Productos Leidos"),t.k0s()()()()()(),t.j41(27,"div",10)(28,"div",18)(29,"div",3)(30,"div",12)(31,"div",19),t.nrm(32,"i",20),t.k0s(),t.j41(33,"div",15)(34,"h4",21),t.EFF(35),t.k0s(),t.j41(36,"p",17),t.EFF(37,"Productos Conformes"),t.k0s()()()()()(),t.j41(38,"div",10)(39,"div",22)(40,"div",3)(41,"div",12)(42,"div",23),t.nrm(43,"i",24),t.k0s(),t.j41(44,"div",15)(45,"h4",16),t.EFF(46),t.k0s(),t.j41(47,"p",17),t.EFF(48,"Productos No Conformes"),t.k0s()()()()()(),t.j41(49,"div",10)(50,"div",25)(51,"div",3)(52,"div",12)(53,"div",26),t.nrm(54,"i",27),t.k0s(),t.j41(55,"div",15)(56,"h4",16),t.EFF(57),t.k0s(),t.j41(58,"p",17),t.EFF(59,"Equipos Registrados"),t.k0s()()()()()()(),t.j41(60,"div",0)(61,"div",10)(62,"div",28)(63,"div",3)(64,"div",12)(65,"div",29),t.nrm(66,"i",30),t.k0s(),t.j41(67,"div",15)(68,"h4",16),t.EFF(69),t.k0s(),t.j41(70,"p",17),t.EFF(71,"\xc1reas Registradas"),t.k0s()()()()()(),t.j41(72,"div",10)(73,"div",31)(74,"div",3)(75,"div",12)(76,"div",19),t.nrm(77,"i",32),t.k0s(),t.j41(78,"div",15)(79,"h4",21),t.EFF(80,"0"),t.k0s(),t.j41(81,"p",17),t.EFF(82,"Revisiones Auditoria"),t.k0s()()()()()(),t.j41(83,"div",10)(84,"div",33)(85,"div",3)(86,"div",12)(87,"div",34),t.nrm(88,"i",35),t.k0s(),t.j41(89,"div",15)(90,"h4",16),t.EFF(91,"0"),t.k0s(),t.j41(92,"p",17),t.EFF(93,"Registros de Novedades"),t.k0s()()()()()(),t.j41(94,"div",10)(95,"div",36)(96,"div",3)(97,"div",12)(98,"div",37),t.nrm(99,"i",38),t.k0s(),t.j41(100,"div",15)(101,"h4",16),t.EFF(102,"0"),t.k0s(),t.j41(103,"p",17),t.EFF(104,"??"),t.k0s()()()()()()(),t.j41(105,"div",39)(106,"div",40)(107,"div",41)(108,"div",42)(109,"ul",43)(110,"li",44),t.bIt("click",function(){return n.panel="global"}),t.EFF(111,"Inventario Global"),t.k0s(),t.j41(112,"li",44),t.bIt("click",function(){return n.panel="teams"}),t.EFF(113,"Inventario por Equipos"),t.k0s(),t.j41(114,"li",44),t.bIt("click",function(){return n.panel="notCompliant"}),t.EFF(115,"Inventario No Conformes"),t.k0s()(),t.j41(116,"div",12)(117,"input",45),t.mxI("ngModelChange",function(r){return t.DH7(n.globalSearch,r)||(n.globalSearch=r),r}),t.bIt("ngModelChange",function(){return n.onGlobalFilterChange()}),t.k0s()()(),t.j41(118,"div",3),t.DNE(119,M,38,7,"div",46)(120,U,24,7,"div",46)(121,z,46,10,"div",46),t.k0s()()()(),t.DNE(122,Q,22,4,"div",47)),2&o&&(t.R7$(11),t.JRh(t.ii3(12,18,n.selectedDate,"fullDate","","es")),t.R7$(3),t.R50("ngModel",n.selectedDate),t.R7$(10),t.JRh(n.globalCount||"0"),t.R7$(11),t.JRh(n.validatedTrueCount||"0"),t.R7$(11),t.JRh(n.validatedFalseCount||"0"),t.R7$(11),t.JRh(n.teamCount||"0"),t.R7$(12),t.JRh(n.areaCount||"0"),t.R7$(41),t.AVh("active","global"===n.panel),t.R7$(2),t.AVh("active","teams"===n.panel),t.R7$(2),t.AVh("active","notCompliant"===n.panel),t.R7$(3),t.R50("ngModel",n.globalSearch),t.R7$(2),t.Y8G("ngIf","global"===n.panel),t.R7$(),t.Y8G("ngIf","teams"===n.panel),t.R7$(),t.Y8G("ngIf","notCompliant"===n.panel),t.R7$(),t.Y8G("ngIf",n.showAnnotationModal))},dependencies:[h.G,l.Sq,l.bT,v.xH,v.y7,v.me,v.wz,v.BC,v.vS,l.vh,v.YN],styles:[".annotation-modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000073;display:flex;align-items:center;justify-content:center;z-index:2000}.annotation-modal.dialog-card[_ngcontent-%COMP%]{width:90%;max-width:720px;padding:0 12px}.annotation-modal[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{border-radius:6px;overflow:hidden}.annotation-modal[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;justify-content:space-between}"]})}}return a})()}}]);