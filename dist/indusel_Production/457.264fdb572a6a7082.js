"use strict";(self.webpackChunkfree_version=self.webpackChunkfree_version||[]).push([[457],{5457:(D,p,l)=>{l.r(p),l.d(p,{WarehouseModule:()=>b});var E=l(2200),C=l(8132),a=l(9275),t=l(3664),m=l(8728);const I=[{path:"",component:a.DashInventories,children:[{path:"dash",loadComponent:()=>Promise.resolve().then(l.bind(l,9275)).then(d=>d.DashInventories)}]},{path:"checkNews",loadComponent:()=>l.e(899).then(l.bind(l,1899)).then(d=>d.CheckNews)},{path:"configInventories",loadComponent:()=>l.e(109).then(l.bind(l,4109)).then(d=>d.ConfigureInventories)}];let j=(()=>{class d{static{this.\u0275fac=function(f){return new(f||d)}}static{this.\u0275mod=t.$C({type:d})}static{this.\u0275inj=m.G2t({imports:[C.iI.forChild(I),C.iI]})}}return d})();var g=l(3525);let b=(()=>{class d{static{this.\u0275fac=function(f){return new(f||d)}}static{this.\u0275mod=t.$C({type:d})}static{this.\u0275inj=m.G2t({imports:[E.MD,g.oi,j]})}}return d})()},9275:(D,p,l)=>{l.r(p),l.d(p,{DashInventories:()=>P});var E=l(177),C=l(4799),a=l(8728),t=l(3664),m=l(4341),I=l(9330),j=l(8810),g=l(9437),b=l(2525);let d=(()=>{class s{constructor(){this.http=(0,a.WQX)(I.Qq),this.BASE_URL=b.c.backendUrl,this.BASE_API=b.c.api,this.SEE_GROUPS_ENDPOINT=`${this.BASE_URL}${this.BASE_API}/storage/seeGroups`,this.CONFIRMED_COUNT_ENDPOINT=`${this.BASE_URL}${this.BASE_API}/storage/confirmedCount`,this.DUPLICATES_ENDPOINT=`${this.BASE_URL}${this.BASE_API}/storage/duplicates`,this.GLOBALCOUNT_ENDPOINT=`${this.BASE_URL}${this.BASE_API}/storage/countGlobal`,this.GLOBALCOUNT_TEAMCOUNT=`${this.BASE_URL}${this.BASE_API}/storage/teamCount`,this.GLOBALCOUNT_AREACOUNT=`${this.BASE_URL}${this.BASE_API}/storage/areaCount`,this.GLOBALCOUNT_VIEWINVENTORIES=`${this.BASE_URL}${this.BASE_API}/storage/viewInventories`}handleError(e){console.error("DashInventoryServices: Error en la petici\xf3n:",e);let n="Ocurri\xf3 un error desconocido en el servicio.";return e.error&&e.er?.msg?n=e.error.msg:e.message&&(n=e.message),(0,j.$)(()=>new Error(`Fall\xf3 la consulta al backend: ${n}`))}getStorageGroups(e){return this.http.post(this.SEE_GROUPS_ENDPOINT,{date:e}).pipe((0,g.W)(this.handleError.bind(this)))}getConfirmedCount(e){return this.http.post(this.CONFIRMED_COUNT_ENDPOINT,{date:e}).pipe((0,g.W)(this.handleError.bind(this)))}getDuplicates(e){return this.http.post(this.DUPLICATES_ENDPOINT,{date:e}).pipe((0,g.W)(this.handleError.bind(this)))}getCountGlobal(e){return this.http.post(this.GLOBALCOUNT_ENDPOINT,{date:e}).pipe((0,g.W)(this.handleError.bind(this)))}getTeamCount(e){return this.http.post(this.GLOBALCOUNT_TEAMCOUNT,{date:e}).pipe((0,g.W)(this.handleError.bind(this)))}getAreaCount(e){return this.http.post(this.GLOBALCOUNT_AREACOUNT,{date:e}).pipe((0,g.W)(this.handleError.bind(this)))}getViewInventories(e){return this.http.post(this.GLOBALCOUNT_VIEWINVENTORIES,{date:e}).pipe((0,g.W)(this.handleError.bind(this)))}getTeamItems(e,n){const o={date:e,...n};return this.http.post(`${this.BASE_URL}/storage/teamItems`,o).pipe((0,g.W)(this.handleError.bind(this)))}static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275prov=a.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var T=l(2389),v=l(2200);function f(s,c){if(1&s&&(t.j41(0,"option",62),t.EFF(1),t.k0s()),2&s){const e=c.$implicit;t.Y8G("value",e),t.R7$(),t.JRh(e)}}function k(s,c){if(1&s&&(t.j41(0,"option",62),t.EFF(1),t.k0s()),2&s){const e=c.$implicit;t.Y8G("value",e.key),t.R7$(),t.JRh(e.label)}}function y(s,c){if(1&s){const e=t.RV6();t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s(),t.j41(11,"td",60)(12,"button",63),t.bIt("click",function(){const o=a.eBV(e).$implicit,i=t.XpG(2);return a.Njj(i.openAnnotationModal(o))}),t.nrm(13,"i",64),t.k0s()()()}if(2&s){const e=c.$implicit,n=t.XpG(2);t.R7$(2),t.JRh(e.code),t.R7$(2),t.JRh(e.codRef),t.R7$(2),t.JRh(e.referencia),t.R7$(2),t.JRh(e.area),t.R7$(2),t.JRh(e.teamLabel||n.computeTeamKey(e))}}function x(s,c){1&s&&(t.j41(0,"tr")(1,"td",65),t.EFF(2,"No hay registros para la fecha seleccionada"),t.k0s()())}function A(s,c){if(1&s){const e=t.RV6();t.j41(0,"div")(1,"div",48)(2,"div",49)(3,"input",50),t.mxI("ngModelChange",function(o){a.eBV(e);const i=t.XpG();return t.DH7(i.filterText,o)||(i.filterText=o),a.Njj(o)}),t.bIt("ngModelChange",function(){a.eBV(e);const o=t.XpG();return a.Njj(o.applyGlobalFilters())}),t.k0s()(),t.j41(4,"div",49)(5,"select",51),t.mxI("ngModelChange",function(o){a.eBV(e);const i=t.XpG();return t.DH7(i.filterArea,o)||(i.filterArea=o),a.Njj(o)}),t.bIt("change",function(){a.eBV(e);const o=t.XpG();return a.Njj(o.applyGlobalFilters())}),t.j41(6,"option",52),t.EFF(7,"Todas las \xc1reas"),t.k0s(),t.DNE(8,f,2,2,"option",53),t.k0s()(),t.j41(9,"div",49)(10,"select",51),t.mxI("ngModelChange",function(o){a.eBV(e);const i=t.XpG();return t.DH7(i.filterTeam,o)||(i.filterTeam=o),a.Njj(o)}),t.bIt("change",function(){a.eBV(e);const o=t.XpG();return a.Njj(o.applyGlobalFilters())}),t.j41(11,"option",52),t.EFF(12,"Todos los Equipos"),t.k0s(),t.DNE(13,k,2,2,"option",53),t.k0s()(),t.j41(14,"div",54)(15,"button",55),t.bIt("click",function(){a.eBV(e);const o=t.XpG();return a.Njj(o.resetGlobalFilters())}),t.EFF(16,"Reset"),t.k0s(),t.j41(17,"button",56),t.bIt("click",function(){a.eBV(e);const o=t.XpG();return a.Njj(o.loadAllData(o.formatDateForBackend(o.selectedDate)))}),t.EFF(18,"Refrescar"),t.k0s()()(),t.j41(19,"div",57)(20,"table",58)(21,"thead",59)(22,"tr")(23,"th"),t.EFF(24,"C\xf3digo"),t.k0s(),t.j41(25,"th"),t.EFF(26,"CodRef"),t.k0s(),t.j41(27,"th"),t.EFF(28,"Referencia"),t.k0s(),t.j41(29,"th"),t.EFF(30,"\xc1rea"),t.k0s(),t.j41(31,"th"),t.EFF(32,"Equipo"),t.k0s(),t.j41(33,"th",60),t.EFF(34,"Anotaciones"),t.k0s()()(),t.j41(35,"tbody"),t.DNE(36,y,14,5,"tr",61)(37,x,3,0,"tr",46),t.k0s()()()()}if(2&s){const e=t.XpG();t.R7$(3),t.R50("ngModel",e.filterText),t.R7$(2),t.R50("ngModel",e.filterArea),t.R7$(3),t.Y8G("ngForOf",e.areaOptions),t.R7$(2),t.R50("ngModel",e.filterTeam),t.R7$(3),t.Y8G("ngForOf",e.teamOptions),t.R7$(23),t.Y8G("ngForOf",e.filteredInventory),t.R7$(),t.Y8G("ngIf",0===e.filteredInventory.length)}}function G(s,c){if(1&s&&(t.j41(0,"option",62),t.EFF(1),t.k0s()),2&s){const e=c.$implicit;t.Y8G("value",e.key),t.R7$(),t.Lme("",e.label," \u2014 ",e.area)}}function N(s,c){if(1&s&&(t.j41(0,"li",80),t.EFF(1),t.k0s()),2&s){const e=c.$implicit;t.R7$(),t.JRh(e)}}function L(s,c){if(1&s&&(t.j41(0,"div")(1,"h6",5),t.EFF(2),t.k0s(),t.j41(3,"p",76),t.EFF(4,"Registros: "),t.j41(5,"strong"),t.EFF(6),t.k0s()(),t.j41(7,"div",77)(8,"ul",78),t.DNE(9,N,2,1,"li",79),t.k0s()()()),2&s){const e=t.XpG(2);t.R7$(2),t.JRh(e.teamLeft.area||"\u2014"),t.R7$(4),t.JRh(e.teamLeft.total||0),t.R7$(3),t.Y8G("ngForOf",e.teamLeft.codes)}}function M(s,c){1&s&&(t.j41(0,"div",81),t.EFF(1,"Elige un equipo para ver c\xf3digos"),t.k0s())}function O(s,c){if(1&s&&(t.j41(0,"option",62),t.EFF(1),t.k0s()),2&s){const e=c.$implicit;t.Y8G("value",e.key),t.R7$(),t.Lme("",e.label," \u2014 ",e.area)}}function $(s,c){if(1&s&&(t.j41(0,"li",80),t.EFF(1),t.k0s()),2&s){const e=c.$implicit;t.R7$(),t.JRh(e)}}function S(s,c){if(1&s&&(t.j41(0,"div")(1,"h6",5),t.EFF(2),t.k0s(),t.j41(3,"p",76),t.EFF(4,"Registros: "),t.j41(5,"strong"),t.EFF(6),t.k0s()(),t.j41(7,"div",77)(8,"ul",78),t.DNE(9,$,2,1,"li",79),t.k0s()()()),2&s){const e=t.XpG(2);t.R7$(2),t.JRh(e.teamRight.area||"\u2014"),t.R7$(4),t.JRh(e.teamRight.total||0),t.R7$(3),t.Y8G("ngForOf",e.teamRight.codes)}}function B(s,c){1&s&&(t.j41(0,"div",81),t.EFF(1,"Elige un equipo para ver c\xf3digos"),t.k0s())}function w(s,c){if(1&s&&(t.j41(0,"div",82)(1,"small",81),t.EFF(2),t.k0s()()),2&s){const e=t.XpG(2);t.R7$(2),t.Lme("Coincidencias: ",e.comparisonResult.matchCount,", Diferencias: ",e.comparisonResult.diffCount)}}function V(s,c){if(1&s){const e=t.RV6();t.j41(0,"div")(1,"div",66)(2,"div",67)(3,"div",68)(4,"select",51),t.mxI("ngModelChange",function(o){a.eBV(e);const i=t.XpG();return t.DH7(i.selectedTeamLeft,o)||(i.selectedTeamLeft=o),a.Njj(o)}),t.bIt("change",function(){a.eBV(e);const o=t.XpG();return a.Njj(o.onSelectTeam("left"))}),t.j41(5,"option",52),t.EFF(6,"Selecciona equipo (Izq)"),t.k0s(),t.DNE(7,G,2,3,"option",53),t.k0s(),t.j41(8,"button",69),t.bIt("click",function(){a.eBV(e);const o=t.XpG();return a.Njj(o.clearTeam("left"))}),t.EFF(9,"Limpiar"),t.k0s()(),t.j41(10,"div",70)(11,"div",3),t.DNE(12,L,10,3,"div",46)(13,M,2,0,"div",71),t.k0s()()(),t.j41(14,"div",67)(15,"div",68)(16,"select",51),t.mxI("ngModelChange",function(o){a.eBV(e);const i=t.XpG();return t.DH7(i.selectedTeamRight,o)||(i.selectedTeamRight=o),a.Njj(o)}),t.bIt("change",function(){a.eBV(e);const o=t.XpG();return a.Njj(o.onSelectTeam("right"))}),t.j41(17,"option",52),t.EFF(18,"Selecciona equipo (Der)"),t.k0s(),t.DNE(19,O,2,3,"option",53),t.k0s(),t.j41(20,"button",69),t.bIt("click",function(){a.eBV(e);const o=t.XpG();return a.Njj(o.clearTeam("right"))}),t.EFF(21,"Limpiar"),t.k0s()(),t.j41(22,"div",70)(23,"div",3),t.DNE(24,S,10,3,"div",46)(25,B,2,0,"div",71),t.k0s()()()(),t.j41(26,"div",72)(27,"button",73),t.bIt("click",function(){a.eBV(e);const o=t.XpG();return a.Njj(o.compareTeams())}),t.EFF(28,"Comparar equipos"),t.k0s(),t.j41(29,"button",74),t.bIt("click",function(){a.eBV(e);const o=t.XpG();return a.Njj(o.exportComparison())}),t.EFF(30,"Exportar (CSV)"),t.k0s(),t.DNE(31,w,3,2,"div",75),t.k0s()()}if(2&s){const e=t.XpG();t.R7$(4),t.R50("ngModel",e.selectedTeamLeft),t.R7$(3),t.Y8G("ngForOf",e.teamOptions),t.R7$(5),t.Y8G("ngIf",e.teamLeft),t.R7$(),t.Y8G("ngIf",!e.teamLeft),t.R7$(3),t.R50("ngModel",e.selectedTeamRight),t.R7$(3),t.Y8G("ngForOf",e.teamOptions),t.R7$(5),t.Y8G("ngIf",e.teamRight),t.R7$(),t.Y8G("ngIf",!e.teamRight),t.R7$(6),t.Y8G("ngIf",e.comparisonResult)}}function U(s,c){if(1&s){const e=t.RV6();t.j41(0,"div",83)(1,"div",84)(2,"div",41)(3,"div",85)(4,"strong"),t.EFF(5,"Anotaci\xf3n - C\xf3digo:"),t.k0s(),t.j41(6,"small",86),t.EFF(7),t.k0s(),t.j41(8,"button",87),t.bIt("click",function(){a.eBV(e);const o=t.XpG();return a.Njj(o.closeAnnotationModal())}),t.k0s()(),t.j41(9,"div",3)(10,"p",88)(11,"small",81),t.EFF(12),t.k0s()(),t.j41(13,"div",89)(14,"label",90),t.EFF(15,"Anotaci\xf3n"),t.k0s(),t.j41(16,"textarea",91),t.mxI("ngModelChange",function(o){a.eBV(e);const i=t.XpG();return t.DH7(i.annotationText,o)||(i.annotationText=o),a.Njj(o)}),t.k0s()(),t.j41(17,"div",92)(18,"button",74),t.bIt("click",function(){a.eBV(e);const o=t.XpG();return a.Njj(o.closeAnnotationModal())}),t.EFF(19,"Cancelar"),t.k0s(),t.j41(20,"button",73),t.bIt("click",function(){a.eBV(e);const o=t.XpG();return a.Njj(o.saveAnnotation())}),t.EFF(21,"Guardar"),t.k0s()()()()()()}if(2&s){const e=t.XpG();t.R7$(7),t.JRh(null==e.annotationItem?null:e.annotationItem.code),t.R7$(5),t.Lme("Referencia: ",null==e.annotationItem?null:e.annotationItem.referencia," \u2014 \xc1rea: ",null==e.annotationItem?null:e.annotationItem.area),t.R7$(4),t.R50("ngModel",e.annotationText)}}(0,E.EO)(C.A,"es");let P=(()=>{class s{constructor(){this.dashboardService=(0,a.WQX)(d),this.selectedDate=this.formatDate(new Date),this.storageGroupsData=[],this.confirmedCountData=[],this.duplicatesData=[],this.productosLeidosCount=0,this.equiposRegistradosCount=0,this.duplicadosCount=0,this.productosOkCount=0,this.noConformesCount=0,this.revisionesCount=0,this.configuracionesCount=0,this.bloqueosCount=0,this.globalCount=0,this.validatedTrueCount=0,this.validatedFalseCount=0,this.teamCount=0,this.areaCount=0,this.showAnnotationModal=!1,this.annotationItem=null,this.annotationText="",this.panel="global",this.globalSearch="",this.filterText="",this.filterArea="",this.filterTeam="",this.areaOptions=[],this.teamOptions=[],this.loading=!1,this.errorMessage="",this.inventoryList=[],this.filteredInventory=[],this.selectedTeamLeft="",this.selectedTeamRight="",this.teamLeft=null,this.teamRight=null,this.comparisonResult=null,this.loadAllData(this.formatDateForBackend(this.selectedDate))}formatDate(e){const n=new Date(e);let o=""+(n.getMonth()+1),i=""+n.getDate();const r=n.getFullYear();return o.length<2&&(o="0"+o),i.length<2&&(i="0"+i),[r,o,i].join("-")}formatDateForBackend(e){const n="string"==typeof e?new Date(e.replace(/-/g,"/")):e;let o=""+n.getDate(),i=""+(n.getMonth()+1);const r=n.getFullYear();return i.length<2&&(i="0"+i),o.length<2&&(o="0"+o),[o,i,r].join("/")}onDateChange(e){const n=this.formatDateForBackend(e);this.loadAllData(n)}loadAllData(e){this.loading=!0,this.errorMessage="",this.resetCounts(),this.dashboardService.getViewInventories(e).subscribe({next:n=>{if(n?.ok&&n.msg){this.inventoryList=n.msg.items.map(i=>{const r=Array.isArray(i.persons)?i.persons.filter(Boolean):[],h=`${i.area||""}||${r.join("|")}`;return{...i,teamKey:h,teamLabel:r.length?r.join(", "):i.team||i.area||""}}),this.filteredInventory=[...this.inventoryList],this.areaOptions=Array.from(new Set(this.inventoryList.map(i=>i.area).filter(Boolean))).sort();const o=new Map;this.inventoryList.forEach(i=>{const r=Array.isArray(i.persons)?i.persons.filter(Boolean):[],h=`${i.area||""}||${r.join("|")}`;if(!o.has(h)){const F=r.length?`${r.join(", ")}`:i.team||i.area||"Equipo";o.set(h,{label:F,area:i.area})}}),this.teamOptions=Array.from(o.entries()).map(([i,r])=>({key:i,label:r.label,area:r.area}))}else this.inventoryList=[],this.filteredInventory=[],this.areaOptions=[],this.teamOptions=[]},error:n=>{console.error("Error viewInventories:",n),this.errorMessage=n?.message||"Error cargando inventarios",this.inventoryList=[],this.filteredInventory=[],this.areaOptions=[],this.teamOptions=[]}}),this.dashboardService.getStorageGroups(e).subscribe({next:n=>{n&&n.ok&&n.msg?(this.storageGroupsData=Array.isArray(n.msg.data)?n.msg.data:[],this.productosLeidosCount=Number(n.msg.totalRecords??this.storageGroupsData.length??0),this.equiposRegistradosCount=Number(n.msg.totalGroups??0)):(this.storageGroupsData=[],this.productosLeidosCount=0,this.equiposRegistradosCount=0)},error:n=>{console.error("Error getStorageGroups:",n),this.errorMessage=n?.message||"Error cargando grupos de almacenamiento",this.storageGroupsData=[],this.productosLeidosCount=0,this.equiposRegistradosCount=0}}),this.dashboardService.getConfirmedCount(e).subscribe({next:n=>{n&&n.ok&&Array.isArray(n.msg)?(this.confirmedCountData=n.msg,this.productosOkCount=this.confirmedCountData.reduce((o,i)=>o+(Number(i.validatedTrue??0)||0),0),this.noConformesCount=this.confirmedCountData.reduce((o,i)=>o+(Number(i.validatedFalse??0)||0),0),this.revisionesCount=this.confirmedCountData.length):(this.confirmedCountData=[],this.productosOkCount=0,this.noConformesCount=0,this.revisionesCount=0)},error:n=>{console.error("Error getConfirmedCount:",n),this.errorMessage=n?.message||"Error cargando conteo confirmado",this.confirmedCountData=[],this.productosOkCount=0,this.noConformesCount=0,this.revisionesCount=0}}),this.dashboardService.getDuplicates(e).subscribe({next:n=>{n&&n.ok&&n.msg&&Array.isArray(n.msg.data)?(this.duplicatesData=n.msg.data,this.duplicadosCount=this.duplicatesData.length):(this.duplicatesData=[],this.duplicadosCount=0)},error:n=>{console.error("Error getDuplicates:",n),this.errorMessage=n?.message||"Error cargando duplicados",this.duplicatesData=[],this.duplicadosCount=0}}),this.dashboardService.getCountGlobal(e).subscribe({next:n=>{n&&n.ok&&n.msg?(this.globalCount=Number(n.msg.total??0),this.validatedTrueCount=Number(n.msg.validatedTrue??0),this.validatedFalseCount=Number(n.msg.validatedFalse??0)):(this.globalCount=0,this.validatedTrueCount=0,this.validatedFalseCount=0)},error:n=>{console.error("Error getCountGlobal:",n),this.errorMessage=n?.message||"Error cargando conteo global",this.globalCount=0,this.validatedTrueCount=0,this.validatedFalseCount=0}}),this.dashboardService.getTeamCount(e).subscribe({next:n=>{this.teamCount=n&&n.ok&&n.msg?Number(n.msg.totalTeams??0):0},error:n=>{console.error("Error getTeamCount:",n),this.errorMessage=n?.message||"Error cargando conteo de equipos",this.teamCount=0}}),this.dashboardService.getAreaCount(e).subscribe({next:n=>{this.areaCount=n&&n.ok&&n.msg?Number(n.msg.totalAreas??0):0},error:n=>{console.error("Error getAreaCount:",n),this.errorMessage=n?.message||"Error cargando conteo de \xe1reas",this.areaCount=0}}),setTimeout(()=>this.loading=!1,400)}applyGlobalFilters(){const e=(this.filterText||"").toLowerCase();this.filteredInventory=this.inventoryList.filter(n=>{const o=!e||String(n.code||"").toLowerCase().includes(e)||String(n.referencia||"").toLowerCase().includes(e)||String(n.producto||"").toLowerCase().includes(e)||String(n.codRef||"").toLowerCase().includes(e),i=!this.filterArea||n.area===this.filterArea,r=!this.filterTeam||this.computeTeamKey(n)===this.filterTeam;return o&&i&&r})}onGlobalFilterChange(){this.applyGlobalFilters()}resetGlobalFilters(){this.filterText="",this.filterArea="",this.filterTeam="",this.filteredInventory=[...this.inventoryList]}computeTeamKey(e){const n=Array.isArray(e.persons)?e.persons.filter(Boolean):[];return`${e.area||""}||${n.join("|")}`}onSelectTeam(e){const n="left"===e?this.selectedTeamLeft:this.selectedTeamRight;if(!n)return void("left"===e?this.teamLeft=null:this.teamRight=null);const o=this.formatDateForBackend(this.selectedDate);this.dashboardService.getTeamItems(o,{teamKey:n}).subscribe({next:i=>{if(i?.ok&&i.msg){const r=i.msg;"left"===e?this.teamLeft={area:r.area,total:r.total,codes:r.codes.map(h=>h.code)}:this.teamRight={area:r.area,total:r.total,codes:r.codes.map(h=>h.code)}}else"left"===e?this.teamLeft=null:this.teamRight=null},error:i=>{console.error("Error getTeamItems:",i),"left"===e?this.teamLeft=null:this.teamRight=null}})}clearTeam(e){"left"===e?(this.selectedTeamLeft="",this.teamLeft=null):(this.selectedTeamRight="",this.teamRight=null),this.comparisonResult=null}compareTeams(){if(!this.teamLeft||!this.teamRight)return void(this.comparisonResult=null);const e=new Set(this.teamLeft.codes),n=new Set(this.teamRight.codes);let o=0;e.forEach(h=>{n.has(h)&&o++});const r=new Set([...e,...n]).size-o;this.comparisonResult={matchCount:o,diffCount:r}}exportComparison(){if(!this.teamLeft||!this.teamRight)return;const e=this.teamLeft.codes.reduce((u,_)=>(u[_]=(u[_]||0)+1,u),{}),n=this.teamRight.codes.reduce((u,_)=>(u[_]=(u[_]||0)+1,u),{}),r=["code,leftCount,rightCount",...Array.from(new Set([...Object.keys(e),...Object.keys(n)])).map(u=>`${u},${e[u]||0},${n[u]||0}`)].join("\n"),h=new Blob([r],{type:"text/csv;charset=utf-8;"}),F=URL.createObjectURL(h),R=document.createElement("a");R.href=F,R.download=`comparison_${Date.now()}.csv`,R.click(),URL.revokeObjectURL(F)}resetCounts(){this.productosLeidosCount=0,this.equiposRegistradosCount=0,this.duplicadosCount=0,this.productosOkCount=0,this.noConformesCount=0,this.revisionesCount=0,this.validatedTrueCount=0,this.validatedFalseCount=0,this.globalCount=0,this.teamCount=0,this.areaCount=0}openAnnotationModal(e){this.annotationItem=e,this.annotationText=e?.annotation??"",this.showAnnotationModal=!0}closeAnnotationModal(){this.showAnnotationModal=!1,this.annotationItem=null,this.annotationText=""}saveAnnotation(){this.annotationItem&&(this.annotationItem.annotation=(this.annotationText||"").trim(),this.closeAnnotationModal())}static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-dash-inventories"]],features:[t.Jv_([{provide:t.xe9,useValue:"es"}])],decls:120,vars:20,consts:[[1,"row"],[1,"col-12","mb-4"],[1,"card","bg-primary-subtle","text-dark","overflow-hidden"],[1,"card-body"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"mb-1"],[1,"text-muted","mb-0","opacity-75","text-sm"],[1,"col-12","col-md-3"],["type","date",1,"form-control",3,"ngModelChange","change","ngModel"],[1,"row","mb-4"],[1,"col-md-3","mb-3"],[1,"card","total-income-card","overflow-hidden","bg-primary","text-white"],[1,"d-flex","align-items-center"],[1,"avatar","avatar-lg","icon","m-r-5"],[1,"text-white","ti","ti-layout-board-split","f-24"],[1,"ms-2"],[1,"text-white","f-w-600","mb-1"],[1,"mb-0","opacity-50","text-sm"],[1,"card","total-income-card","warning","overflow-hidden"],[1,"avatar","avatar-lg","icon-warning","m-r-5"],[1,"text-warning","ti","ti-layout-board-split","f-24"],[1,"f-w-600","mb-1"],[1,"card","total-income-card","danger","overflow-hidden","bg-danger","text-white"],[1,"avatar","avatar-lg","icon-danger","m-r-5"],[1,"text-white","ti","ti-alert-circle","f-24"],[1,"card","total-income-card","success","overflow-hidden","bg-success","text-white"],[1,"avatar","avatar-lg","icon-success","m-r-5"],[1,"text-white","ti","ti-check","f-24"],[1,"card","total-income-card","info","overflow-hidden","bg-info","text-white"],[1,"avatar","avatar-lg","icon-info","m-r-5"],[1,"text-white","ti","ti-info-circle","f-24"],[1,"card","total-income-card","warning","overflow-hidden","bg-warning","text-dark"],[1,"text-dark","ti","ti-exclamation","f-24"],[1,"card","total-income-card","secondary","overflow-hidden","bg-secondary","text-white"],[1,"avatar","avatar-lg","icon-secondary","m-r-5"],[1,"text-white","ti","ti-settings","f-24"],[1,"card","total-income-card","dark","overflow-hidden","bg-dark","text-white"],[1,"avatar","avatar-lg","icon-dark","m-r-5"],[1,"text-white","ti","ti-lock","f-24"],[1,"row","mt-4"],[1,"col-12"],[1,"card"],[1,"card-header","d-flex","align-items-center","justify-content-between"],[1,"list-group","list-group-horizontal","mb-0"],[1,"list-group-item",3,"click"],["type","text","placeholder","Buscar r\xe1pido (c\xf3digo, ref, producto)",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[4,"ngIf"],["class","annotation-modal-backdrop",4,"ngIf"],[1,"row","mb-3","g-2"],[1,"col-md-3"],["type","text","placeholder","Buscar c\xf3digo / referencia / producto",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-3","d-flex"],[1,"btn","btn-sm","btn-outline-primary","me-2",3,"click"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"table-responsive"],[1,"table","table-sm","table-hover"],[1,"table-light"],[1,"text-center"],[4,"ngFor","ngForOf"],[3,"value"],["title","Agregar / ver anotaci\xf3n",1,"btn","btn-sm","btn-outline-secondary",3,"click"],[1,"ti","ti-note"],["colspan","6",1,"text-center","text-muted"],[1,"row","mb-3"],[1,"col-md-6"],[1,"mb-2","d-flex","align-items-center","gap-2"],[1,"btn","btn-sm","btn-outline-secondary",3,"click"],[1,"card","h-100"],["class","text-muted",4,"ngIf"],[1,"d-flex","gap-2"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-outline-secondary",3,"click"],["class","ms-3",4,"ngIf"],[1,"mb-2","text-muted"],[1,"codes-list",2,"max-height","320px","overflow","auto"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[1,"text-muted"],[1,"ms-3"],[1,"annotation-modal-backdrop"],[1,"annotation-modal","dialog-card"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"text-muted","ms-2"],["type","button","aria-label","Cerrar",1,"btn-close",3,"click"],[1,"mb-2"],[1,"mb-3"],[1,"form-label"],["rows","6","placeholder","Escribe tu nota aqu\xed...",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-end","gap-2"]],template:function(n,o){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div")(6,"h4",5),t.EFF(7,"Consultar Inventario \u{1f4e6} por Fecha \u{1f4c5}"),t.k0s(),t.j41(8,"p",6),t.EFF(9," Fecha Seleccionada: "),t.j41(10,"strong"),t.EFF(11),t.nI1(12,"date"),t.k0s()()(),t.j41(13,"div",7)(14,"input",8),t.mxI("ngModelChange",function(r){return t.DH7(o.selectedDate,r)||(o.selectedDate=r),r}),t.bIt("change",function(){return o.onDateChange(o.selectedDate)}),t.k0s()()()()()()(),t.j41(15,"div",9)(16,"div",10)(17,"div",11)(18,"div",3)(19,"div",12)(20,"div",13),t.nrm(21,"i",14),t.k0s(),t.j41(22,"div",15)(23,"h4",16),t.EFF(24),t.k0s(),t.j41(25,"p",17),t.EFF(26,"Total Productos Leidos"),t.k0s()()()()()(),t.j41(27,"div",10)(28,"div",18)(29,"div",3)(30,"div",12)(31,"div",19),t.nrm(32,"i",20),t.k0s(),t.j41(33,"div",15)(34,"h4",21),t.EFF(35),t.k0s(),t.j41(36,"p",17),t.EFF(37,"Productos Conformes"),t.k0s()()()()()(),t.j41(38,"div",10)(39,"div",22)(40,"div",3)(41,"div",12)(42,"div",23),t.nrm(43,"i",24),t.k0s(),t.j41(44,"div",15)(45,"h4",16),t.EFF(46),t.k0s(),t.j41(47,"p",17),t.EFF(48,"Productos No Conformes"),t.k0s()()()()()(),t.j41(49,"div",10)(50,"div",25)(51,"div",3)(52,"div",12)(53,"div",26),t.nrm(54,"i",27),t.k0s(),t.j41(55,"div",15)(56,"h4",16),t.EFF(57),t.k0s(),t.j41(58,"p",17),t.EFF(59,"Equipos Registrados"),t.k0s()()()()()()(),t.j41(60,"div",0)(61,"div",10)(62,"div",28)(63,"div",3)(64,"div",12)(65,"div",29),t.nrm(66,"i",30),t.k0s(),t.j41(67,"div",15)(68,"h4",16),t.EFF(69),t.k0s(),t.j41(70,"p",17),t.EFF(71,"\xc1reas Registradas"),t.k0s()()()()()(),t.j41(72,"div",10)(73,"div",31)(74,"div",3)(75,"div",12)(76,"div",19),t.nrm(77,"i",32),t.k0s(),t.j41(78,"div",15)(79,"h4",21),t.EFF(80,"0"),t.k0s(),t.j41(81,"p",17),t.EFF(82,"Revisiones Auditoria"),t.k0s()()()()()(),t.j41(83,"div",10)(84,"div",33)(85,"div",3)(86,"div",12)(87,"div",34),t.nrm(88,"i",35),t.k0s(),t.j41(89,"div",15)(90,"h4",16),t.EFF(91,"0"),t.k0s(),t.j41(92,"p",17),t.EFF(93,"Registros de Novedades"),t.k0s()()()()()(),t.j41(94,"div",10)(95,"div",36)(96,"div",3)(97,"div",12)(98,"div",37),t.nrm(99,"i",38),t.k0s(),t.j41(100,"div",15)(101,"h4",16),t.EFF(102,"0"),t.k0s(),t.j41(103,"p",17),t.EFF(104,"??"),t.k0s()()()()()()(),t.j41(105,"div",39)(106,"div",40)(107,"div",41)(108,"div",42)(109,"ul",43)(110,"li",44),t.bIt("click",function(){return o.panel="global"}),t.EFF(111,"Inventario Global"),t.k0s(),t.j41(112,"li",44),t.bIt("click",function(){return o.panel="teams"}),t.EFF(113,"Inventario por Equipos"),t.k0s()(),t.j41(114,"div",12)(115,"input",45),t.mxI("ngModelChange",function(r){return t.DH7(o.globalSearch,r)||(o.globalSearch=r),r}),t.bIt("ngModelChange",function(){return o.onGlobalFilterChange()}),t.k0s()()(),t.j41(116,"div",3),t.DNE(117,A,38,7,"div",46)(118,V,32,9,"div",46),t.k0s()()()(),t.DNE(119,U,22,4,"div",47)),2&n&&(t.R7$(11),t.JRh(t.ii3(12,15,o.selectedDate,"fullDate","","es")),t.R7$(3),t.R50("ngModel",o.selectedDate),t.R7$(10),t.JRh(o.globalCount||"0"),t.R7$(11),t.JRh(o.validatedTrueCount||"0"),t.R7$(11),t.JRh(o.validatedFalseCount||"0"),t.R7$(11),t.JRh(o.teamCount||"0"),t.R7$(12),t.JRh(o.areaCount||"0"),t.R7$(41),t.AVh("active","global"===o.panel),t.R7$(2),t.AVh("active","teams"===o.panel),t.R7$(3),t.R50("ngModel",o.globalSearch),t.R7$(2),t.Y8G("ngIf","global"===o.panel),t.R7$(),t.Y8G("ngIf","teams"===o.panel),t.R7$(),t.Y8G("ngIf",o.showAnnotationModal))},dependencies:[T.G,v.Sq,v.bT,m.xH,m.y7,m.me,m.wz,m.BC,m.vS,v.vh,m.YN],styles:[".annotation-modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000073;display:flex;align-items:center;justify-content:center;z-index:2000}.annotation-modal.dialog-card[_ngcontent-%COMP%]{width:90%;max-width:720px;padding:0 12px}.annotation-modal[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{border-radius:6px;overflow:hidden}.annotation-modal[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;justify-content:space-between}"]})}}return s})()}}]);