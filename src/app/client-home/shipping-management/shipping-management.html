<!-- app/client-home/shipping-management/shipping-management.html -->
<div class="dashboard-wrapper">
  <header class="main-header">
    <div class="header-content">
      <div class="brand-section">
        <h1>Gesti√≥n de Env√≠os <span>Casa Cliente INDUSEL</span></h1>
        <p class="subtitle">Proceso de creaci√≥n de Gu√≠as y Consolidaci√≥n</p>
      </div>
      <div class="header-actions">
        <button class="export-btn" (click)="exportToExcel()" [disabled]="selectedItems.length === 0">
          üì• Descargar Excel ({{selectedItems.length}})
        </button>
      </div>
    </div>
  </header>

  <main class="dashboard-body">
    <section class="actions-console">
      
      <div class="console-card search-card">
        <label class="console-label">Buscador Inteligente</label>
        <div class="input-group-modern">
          <span class="input-icon">üîç</span>
          <input 
            type="text" 
            [(ngModel)]="searchQuery" 
            (input)="onSearch()"
            placeholder="EAN, Nombre, Documento o OC..."
            class="modern-input">
          
          <div class="search-results-overlay" *ngIf="filteredResults.length > 0">
            <div class="result-item" *ngFor="let res of filteredResults" (click)="toggleSelection(res)">
              <div class="res-info">
                <strong>{{res.storePurchaseOrder}}</strong>
                <span>{{res.clientName}}</span>
                <small>{{res.clientIdentification}} | EAN: {{res.ean}}</small>
              </div>
              <button class="add-mini-btn">+</button>
            </div>
          </div>
        </div>
      </div>

      <div class="console-card upload-card-modern">
        <label class="console-label">Actualizaci√≥n Masiva de Gu√≠as</label>
        <div class="upload-controls">
          <div class="file-selector" (click)="!isUploading && fileInput.click()" [class.disabled]="isUploading">
            <span class="file-icon">{{ isUploading ? '‚è≥' : 'üìÑ' }}</span>
            <div class="file-details">
              <span class="file-name">{{ selectedFile ? selectedFile.name : 'Seleccionar Excel' }}</span>
              <span class="file-hint" *ngIf="!isUploading">Formato .xlsx</span>
              
              <div class="mini-progress-container" *ngIf="isUploading">
                <div class="mini-progress-bar" [style.width.%]="uploadProgress"></div>
              </div>
            </div>
          </div>

          <input #fileInput type="file" (change)="onFileSelected($event)" accept=".xlsx" hidden>

          <button 
            class="btn-action-primary" 
            [disabled]="!selectedFile || isUploading"
            (click)="uploadShipments()">
            <span *ngIf="!isUploading">üöÄ Actualizar</span>
            <span *ngIf="isUploading">{{ uploadProgress }}%</span>
          </button>
        </div>
      </div>
    </section>

    <section class="selection-area">
      <div class="table-container">
        <div class="table-header">
          <h3>Lista de √çtems para Gesti√≥n</h3>
          <p>Has seleccionado {{selectedItems.length}} pedidos para procesar</p>
        </div>

        <table class="modern-table">
          <thead>
            <tr>
              <th>Orden de Compra</th>
              <th>Cliente</th>
              <th>Identificaci√≥n</th>
              <th>Ciudad</th>
              <th>EAN</th>
              <th>Acci√≥n</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of selectedItems; let i = index">
              <td><strong>{{item.storePurchaseOrder}}</strong></td>
              <td>{{item.clientName}}</td>
              <td>{{item.clientIdentification}}</td>
              <td>{{item.city}}</td>
              <td>{{item.ean}}</td>
              <td>
                <button class="btn-remove" (click)="removeItem(i)">‚ùå</button>
              </td>
            </tr>
            <tr *ngIf="selectedItems.length === 0">
              <td colspan="6" class="empty-state">
                No has seleccionado ning√∫n √≠tem todav√≠a. Usa el buscador superior.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>
</div>
