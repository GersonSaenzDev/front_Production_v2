<!-- /app/barcode-printing/printing-parameters/printing-parameters.html -->
<div class="inventory-container" [ngClass]="{ 'loading': loading }">
  <header class="header">
    <h1>Parámetros de Etiquetas</h1>
  </header>

  <form class="main-content" [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>
    <section class="left-panel" style="display: flex; gap: 2rem; flex-wrap: wrap;">
      
      <!-- Columna 1 -->
      <div style="flex: 1 1 45%; min-width: 300px;">
        <h2>Configuración de Parámetros</h2>

        <div class="form-group">
          <label for="productReference">Referencia en Producción (*)</label>
          <div class="position-relative">
            <input
              id="productReference"
              type="text"
              class="form-control"
              formControlName="productReference"
              placeholder="Escriba código o nombre de referencia"
              autocomplete="off"
              (input)="onReferenceInput($event)"
              (focus)="onFocus()"
              (blur)="onBlur()"
            />

            <div class="autocomplete-results shadow-lg" *ngIf="predictiveList.length > 0 && showDropdown">
              <div
                class="autocomplete-item"
                *ngFor="let item of predictiveList; let i = index"
                (click)="selectReference(item)"
              >
                <div><strong>{{ item.reference }}</strong></div>
                <div class="text-muted small">{{ item.productName }}</div>
              </div>
            </div>

            <div class="spinner" *ngIf="loading" aria-hidden="true">
              <div class="spinner-border spinner-border-sm text-primary" role="status"></div>
            </div>
          </div>
          <div class="invalid-feedback" *ngIf="isFieldInvalid('productReference')">
            La referencia de producción es obligatoria.
          </div>
        </div>

        <hr />

        <h3>Información de la Referencia</h3>

        <div class="form-group">
          <label for="productName">Nombre Producto</label>
          <input id="productName" type="text" class="form-control" formControlName="productName" readonly />
        </div>

        <div class="form-group">
          <label for="EAN">EAN</label>
          <input id="EAN" type="text" class="form-control" formControlName="EAN" readonly />
        </div>

        <div class="form-group">
          <label for="productCode">Código Producto</label>
          <input id="productCode" type="text" class="form-control" formControlName="productCode" readonly />
        </div>
      </div>

      <!-- Columna 2 -->
      <div style="flex: 1 1 45%; min-width: 300px;">
        <h3>&nbsp;</h3> <!-- para alinear con columna 1 -->

        <div class="form-group">
          <label for="reference">Referencia</label>
          <input id="reference" type="text" class="form-control" formControlName="reference" readonly />
        </div>

        <div class="form-group">
          <label for="codRef">codRef</label>
          <input id="codRef" type="text" class="form-control" formControlName="codRef" readonly />
        </div>

        <hr />

        <h3>Etiqueta</h3>
        <div class="form-group">
          <label for="labelCode">Consecutivo (label.code) <span class="text-danger">*</span></label>
          <input
            id="labelCode"
            type="number"
            class="form-control"
            formControlName="labelCode"
            placeholder="Ingrese consecutivo/serial para la etiqueta"
            required
          />
          <div class="invalid-feedback" *ngIf="isFieldInvalid('labelCode')">
            El consecutivo (label.code) es obligatorio.
          </div>
        </div>

        <div class="form-group">
          <label for="labelNote">Notas (opcional)</label>
          <textarea id="labelNote" rows="2" class="form-control" formControlName="labelNote" placeholder="Agregar una nota (opcional)"></textarea>
        </div>

        <div class="button-group" style="margin-top: 1rem;">
          <button type="button" class="btn-secondary" (click)="onCancel()">Cancelar</button>
          <button type="submit" class="btn-primary" [disabled]="form.invalid || submitting">Guardar Referencia</button>
        </div>

        <!-- ALERTA BOOTSTRAP -->
        <div *ngIf="alert.visible" class="mt-3">
          <div class="alert" [ngClass]="{'alert-success': alert.type === 'success', 'alert-danger': alert.type === 'danger'}" role="alert">
            {{ alert.message }}
          </div>
        </div>
      </div>

    </section>
  </form>
</div>